
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../tutorial_stat_routines/stat_routines/">
      
      
        <link rel="next" href="../../abcd_rooparametrichist_tutorial/rooparametrichist_exercise/">
      
      
      <link rel="icon" href="../../logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.4">
    
    
      
        <title>Model building - Combine</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8608ea7d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../mystyle.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#building-statistical-models-with-combine" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
  You're not viewing the latest version.
  <a href="../../.."> 


    <strong>Click here to go to latest.</strong>
  </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),base=new URL("../.."),outdated=__md_get("__outdated",sessionStorage,base);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Combine" class="md-header__button md-logo" aria-label="Combine" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Combine
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Model building
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/cms-analysis/HiggsAnalysis-CombinedLimit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../what_combine_does/introduction/" class="md-tabs__link">
          
  
    
  
  What Combine Does

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../part2/settinguptheanalysis/" class="md-tabs__link">
          
  
    
  
  Setting up the analysis

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../part3/runningthetool/" class="md-tabs__link">
          
  
    
  
  Running combine

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../part5/roofit/" class="md-tabs__link">
          
  
    
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../part4/usefullinks/" class="md-tabs__link">
        
  
    
  
  Links & FAQ

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Combine" class="md-nav__button md-logo" aria-label="Combine" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    Combine
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/cms-analysis/HiggsAnalysis-CombinedLimit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    What Combine Does
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            What Combine Does
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../what_combine_does/introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../what_combine_does/model_and_likelihood/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Model and Likelihood
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../what_combine_does/fitting_concepts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fitting Concepts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../what_combine_does/statistical_tests/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Statistical Tests
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Setting up the analysis
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Setting up the analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/settinguptheanalysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Preparing the datacard
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Physics models
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Physics models
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/physicsmodels/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/higgscouplings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SM Higgs coupling models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/bsm-higgs-models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BSM Higgs models
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/bin-wise-stats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Automatic MC statistical uncertainties
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Running combine
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Running combine
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/runningthetool/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Running the tool
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/commonstatsmethods/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Common statistical methods
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/nonstandard/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced use cases
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/simplifiedlikelihood/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Simplified Likelihoods
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/regularisation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unfolding & regularization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/validation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Validating datacards
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/debugging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debugging fit failures
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/roofit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RooFit Basics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Main Features
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Main Features
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/longexercise/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Exercises
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/longexerciseanswers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Solutions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial2023/parametric_exercise/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parametric Models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial2023_unfolding/unfolding_exercise/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Likelihood Based Unfolding
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial_stat_routines/stat_routines/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Statitiscal Tests Basics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Model building
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Model building
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    <span class="md-ellipsis">
      Getting started
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-outline" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise outline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#keywords" class="md-nav__link">
    <span class="md-ellipsis">
      Keywords
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simultaneous-fit-in-multiple-categories" class="md-nav__link">
    <span class="md-ellipsis">
      Simultaneous fit in multiple categories
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rate-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Rate parameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extra-arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Extra arguments
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#physics-models" class="md-nav__link">
    <span class="md-ellipsis">
      Physics Models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Physics Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-physics-model" class="md-nav__link">
    <span class="md-ellipsis">
      Default physics model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-signal-model" class="md-nav__link">
    <span class="md-ellipsis">
      Multi Signal model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-models" class="md-nav__link">
    <span class="md-ellipsis">
      Custom models
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eft-model" class="md-nav__link">
    <span class="md-ellipsis">
      EFT model
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../abcd_rooparametrichist_tutorial/rooparametrichist_exercise/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Per-bin Transfer Factors with Parametric Histograms
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/usefullinks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Links & FAQ
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    <span class="md-ellipsis">
      Getting started
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-outline" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise outline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#keywords" class="md-nav__link">
    <span class="md-ellipsis">
      Keywords
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simultaneous-fit-in-multiple-categories" class="md-nav__link">
    <span class="md-ellipsis">
      Simultaneous fit in multiple categories
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rate-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Rate parameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extra-arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Extra arguments
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#physics-models" class="md-nav__link">
    <span class="md-ellipsis">
      Physics Models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Physics Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default-physics-model" class="md-nav__link">
    <span class="md-ellipsis">
      Default physics model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-signal-model" class="md-nav__link">
    <span class="md-ellipsis">
      Multi Signal model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-models" class="md-nav__link">
    <span class="md-ellipsis">
      Custom models
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eft-model" class="md-nav__link">
    <span class="md-ellipsis">
      EFT model
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="building-statistical-models-with-combine">Building statistical models with Combine</h1>
<h2 id="getting-started">Getting started</h2>
<p>To get started, you should have a working setup of <span style="font-variant:small-caps;">Combine</span>, please follow the instructions from the <a href="https://cms-analysis.github.io/HiggsAnalysis-CombinedLimit/latest/#within-cmssw-recommended-for-cms-users">home page</a>. Make sure to use the latest recommended release.</p>
<p>After setting up <span style="font-variant:small-caps;">Combine</span>, you can access the working directory for this tutorial which contains all of the inputs and scripts needed in this excercise exercise:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span><span class="nv">$CMSSW_BASE</span>/src/HiggsAnalysis/CombinedLimit/
git<span class="w"> </span>checkout<span class="w"> </span>main<span class="w"> </span>
scram<span class="w"> </span>b<span class="w"> </span>-j<span class="w"> </span><span class="m">8</span>
<span class="nb">cd</span><span class="w"> </span><span class="nv">$CMSSW_BASE</span>/src/HiggsAnalysis/CombinedLimit/data/tutorials/model_building_2024/
</code></pre></div>
<h2 id="exercise-outline">Exercise outline</h2>
<p>This tutorial focuses and extends on the model building topic, and it is not going to give a full picture on the statistical methods, which are extensively covered in the <a href="https://cms-analysis.github.io/HiggsAnalysis-CombinedLimit/latest/part5/longexercise/">long exercise</a> and <a href="https://cms-analysis.github.io/HiggsAnalysis-CombinedLimit/latest/tutorial_stat_routines/stat_routines/">statistical methods exercise</a>. </p>
<p>1) Building analysis with templates </p>
<p>2) Using keywords </p>
<p>3) Control regions </p>
<p>4) Rate parameters </p>
<p>5) Extra arguments  </p>
<p>6) Physics Models</p>
<h2 id="introduction">Introduction</h2>
<p>The most general definition for the binned model likelihood can be given as </p>
<div class="arithmatex">\[ \mathcal{L} =  \mathcal{L}_\mathrm{primary} \cdot \mathcal{L}_\mathrm{auxiliary} = \prod_{c=1}^{N_c} \prod_{b=1}^{N_b^c} \mathrm{Poiss}(n_{cb}; n^\mathrm{exp}_{cb}(\vec{\mu},\vec{\nu})) \cdot \prod_{e=1}^{N_E}  p_e(y_e ; \nu_e) \]</div>
<p>Where <span class="arithmatex">\(c\)</span> indexes the channel, <span class="arithmatex">\(b\)</span> indexes the histogram bin, and <span class="arithmatex">\(e\)</span> indexes the nuisance parameter.</p>
<p>The generic model of the expected event count in a given bin, <span class="arithmatex">\(n^\mathrm{exp}_{cb}\)</span>, implemented in combine for template based analyses is given by:</p>
<div class="arithmatex">\[n^\mathrm{exp}_{cb} = \mathrm{max}(0, \sum_{p} M_{cp}(\vec{\mu})N_{cp}(\nu_G, \vec{\nu}_L,\vec{\nu}_S,\vec{\nu}_{\rho})\omega_{cbp}(\vec{\nu}_S) + E_{cb}(\vec{\nu}_B) ) \]</div>
<p>In terms of datacard structure there are several differences with respect to the counting datacard:</p>
<ul>
<li>A new block of lines at the top defining how channels and processes are mapped to the histograms (more than one line can be used)</li>
<li>In the list of systematic uncertainties we now have entries marked as <code>shape</code></li>
</ul>
<p>The "shapes" line has to follow the following syntax: </p>
<div class="highlight"><pre><span></span><code>shapes<span class="w">   </span>&lt;process_name&gt;<span class="w">   </span>&lt;channel_name&gt;<span class="w">   </span>&lt;path/to/input_shape.root&gt;<span class="w">   </span>&lt;histograms_nominal&gt;<span class="w">  </span>&lt;histograms_with_variations&gt;
</code></pre></div>
<p>To start the hands-on for this section: 
<div class="highlight"><pre><span></span><code>cd $CMSSW_BASE/src/HiggsAnalysis/CombinedLimit/data/tutorials/model_building_2024/simple_shape
</code></pre></div></p>
<p>The input shapes for the first example (<code>datacard-2-template-analysis.txt</code>) are located in the <code>template-analysis-datacard-input.root</code>, it contains the observed distribution <code>data_obs</code>, the nominal histograms for each process and systematic uncertainties templates:  </p>
<div class="highlight"><pre><span></span><code>root<span class="w"> </span><span class="o">[</span><span class="m">0</span><span class="o">]</span><span class="w"> </span>
Attaching<span class="w"> </span>file<span class="w"> </span>template-analysis-datacard-input.root<span class="w"> </span>as<span class="w"> </span>_file0...
<span class="o">(</span>TFile<span class="w"> </span>*<span class="o">)</span><span class="w"> </span>0x556fd5b0fea0
root<span class="w"> </span><span class="o">[</span><span class="m">1</span><span class="o">]</span><span class="w"> </span>.ls
TFile**<span class="w">     </span>template-analysis-datacard-input.root<span class="w">   </span>
<span class="w"> </span>TFile*<span class="w">     </span>template-analysis-datacard-input.root<span class="w">   </span>
<span class="w">  </span>KEY:<span class="w"> </span>TH1F<span class="w"> </span>background<span class="p">;</span><span class="m">1</span><span class="w">    </span>Histogram<span class="w"> </span>of<span class="w"> </span>background__x
<span class="w">  </span>KEY:<span class="w"> </span>TH1F<span class="w"> </span>background_alphaUp<span class="p">;</span><span class="m">1</span><span class="w">    </span>Histogram<span class="w"> </span>of<span class="w"> </span>background__x
<span class="w">  </span>KEY:<span class="w"> </span>TH1F<span class="w"> </span>background_alphaDown<span class="p">;</span><span class="m">1</span><span class="w">  </span>Histogram<span class="w"> </span>of<span class="w"> </span>background__x
<span class="w">  </span>KEY:<span class="w"> </span>TH1F<span class="w"> </span>data_obs<span class="p">;</span><span class="m">1</span><span class="w">  </span>Histogram<span class="w"> </span>of<span class="w"> </span>data_obs__x
<span class="w">  </span>KEY:<span class="w"> </span>TH1F<span class="w"> </span>signal<span class="p">;</span><span class="m">1</span><span class="w">    </span>Histogram<span class="w"> </span>of<span class="w"> </span>signal__x
<span class="w">  </span>KEY:<span class="w"> </span>TH1F<span class="w"> </span>signal_sigmaUp<span class="p">;</span><span class="m">1</span><span class="w">    </span>Histogram<span class="w"> </span>of<span class="w"> </span>signal__x
<span class="w">  </span>KEY:<span class="w"> </span>TH1F<span class="w"> </span>signal_sigmaDown<span class="p">;</span><span class="m">1</span><span class="w">  </span>Histogram<span class="w"> </span>of<span class="w"> </span>signal__x
</code></pre></div>
<p>To define the mapping to the systematic uncertainties templates the <code>$SYSTEMATIC</code> keyword should be used, which connects the systematic uncertainties marked as <code>shape</code> type with the input shapes. </p>
<div class="highlight"><pre><span></span><code>imax<span class="w"> </span><span class="m">1</span>
jmax<span class="w"> </span><span class="m">1</span>
kmax<span class="w"> </span><span class="m">4</span>
<span class="c1"># ---------------</span>
shapes<span class="w">  </span>signal<span class="w">  </span>ch1<span class="w"> </span>template-analysis-datacard-input.root<span class="w"> </span>signal<span class="w"> </span>signal_<span class="nv">$SYSTEMATIC</span>
shapes<span class="w">  </span>background<span class="w">  </span>ch1<span class="w"> </span>template-analysis-datacard-input.root<span class="w"> </span>background<span class="w"> </span>background_<span class="nv">$SYSTEMATIC</span>
<span class="c1"># ---------------</span>
bin<span class="w">         </span>ch1
observation<span class="w"> </span><span class="m">85</span>
<span class="c1"># ------------------------------</span>
bin<span class="w">             </span>ch1<span class="w">        </span>ch1
process<span class="w">         </span>signal<span class="w">     </span>background
process<span class="w">         </span><span class="m">0</span><span class="w">          </span><span class="m">1</span>
rate<span class="w">            </span><span class="m">24</span><span class="w">         </span><span class="m">100</span>
<span class="c1"># --------------------------------</span>
lumi<span class="w">     </span>lnN<span class="w">    </span><span class="m">1</span>.1<span class="w">       </span><span class="m">1</span>.0
bgnorm<span class="w">   </span>lnN<span class="w">    </span>-<span class="w">         </span><span class="m">1</span>.3
alpha<span class="w">  </span>shape<span class="w">    </span>-<span class="w">          </span><span class="m">1</span><span class="w">   </span><span class="c1"># uncertainty in the background template.</span>
sigma<span class="w">  </span>shape<span class="w">    </span><span class="m">0</span>.5<span class="w">        </span>-<span class="w">   </span><span class="c1"># uncertainty in the signal template.</span>
</code></pre></div>
<p>To simplify the shape mapping line the keywords <code>$PROCESS</code>, <code>$CHANNEL</code> can be used. The <code>$PROCESS</code> keyword is associated with the processes listed in the datacard: <code>[signal, background]</code>, it is also possible to use the <code>*</code> wildcard to map multiple processes and/or channels with one line as shown below. </p>
<div class="highlight"><pre><span></span><code>imax<span class="w"> </span><span class="m">1</span>
jmax<span class="w"> </span><span class="m">1</span>
kmax<span class="w"> </span><span class="m">4</span>
<span class="c1"># ---------------</span>
shapes<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>template-analysis-datacard-input.root<span class="w"> </span><span class="nv">$PROCESS</span><span class="w"> </span><span class="nv">$PROCESS_$SYSTEMATIC</span>
<span class="c1"># ---------------</span>
bin<span class="w">         </span>ch1
observation<span class="w"> </span><span class="m">85</span>
<span class="c1"># ------------------------------</span>
bin<span class="w">             </span>ch1<span class="w">        </span>ch1
process<span class="w">         </span>signal<span class="w">     </span>background
process<span class="w">         </span><span class="m">0</span><span class="w">          </span><span class="m">1</span>
rate<span class="w">            </span><span class="m">24</span><span class="w">         </span><span class="m">100</span>
<span class="c1"># --------------------------------</span>
lumi<span class="w">     </span>lnN<span class="w">    </span><span class="m">1</span>.1<span class="w">       </span><span class="m">1</span>.0
bgnorm<span class="w">   </span>lnN<span class="w">    </span>-<span class="w">         </span><span class="m">1</span>.3
alpha<span class="w">  </span>shape<span class="w">    </span>-<span class="w">          </span><span class="m">1</span><span class="w">   </span><span class="c1"># uncertainty in the background template.</span>
sigma<span class="w">  </span>shape<span class="w">    </span><span class="m">0</span>.5<span class="w">        </span>-<span class="w">   </span><span class="c1"># uncertainty in the signal template.</span>
</code></pre></div>
<p>If there are more than one category it can be useful to store the input shapes corresponding to different regions in separate <code>TDirectory</code>s and use $CHANNEL keyword as shown below: </p>
<div class="highlight"><pre><span></span><code>shapes<span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span>&lt;input-file.root&gt;<span class="w"> </span><span class="nv">$CHANNEL</span>/<span class="nv">$PROCESS</span><span class="w"> </span><span class="nv">$CHANNEL</span>/<span class="nv">$PROCESS_$SYSTEMATIC</span>
</code></pre></div>
<h2 id="keywords">Keywords</h2>
<p>Go to the datacards location corresponding to this section of the tutorial:
<div class="highlight"><pre><span></span><code>cd $CMSSW_BASE/src/HiggsAnalysis/CombinedLimit/data/tutorials/model_building_2024/keywords
</code></pre></div></p>
<p>The datacard can also contain <code>$MASS</code> keyword, it allows to setup a single datacard for various mass points. It will be replaced with the value passed to <code>-m</code> option when running the tool. In addition, user-defined keywords can be used. Any word in the datacard <code>$WORD</code> will be replaced by <code>VALUE</code> when including the option <code>--keyword-value WORD=VALUE</code>. This option can be repeated multiple times for multiple keywords.</p>
<p><div class="highlight"><pre><span></span><code> KEY: TH1D  ggH110;1    
 KEY: TH1D  bbH110;1    
 KEY: TH1D  ggH110_CMS_eff_t_mssmHigh_tt_13TeVDown;1    
.... 
 KEY: TH1D  ggH120;1    
 KEY: TH1D  bbH120;1    
 KEY: TH1D  ggH120_CMS_eff_t_mssmHigh_tt_13TeVDown;1    
.....
</code></pre></div>
In the <code>htt_tt_9_13TeV.txt</code> datacard you can find the following lines: </p>
<p><div class="highlight"><pre><span></span><code>shapes * htt_tt_9_13TeV htt_input.root htt_tt_9_13TeV/$PROCESS htt_tt_9_13TeV/$PROCESS_$SYSTEMATIC
shapes bbH htt_tt_9_13TeV htt_input.root htt_tt_9_13TeV/bbH$MASS htt_tt_9_13TeV/bbH$MASS_$SYSTEMATIC
shapes ggH htt_tt_9_13TeV htt_input.root htt_tt_9_13TeV/ggH$MASS htt_tt_9_13TeV/ggH$MASS_$SYSTEMATIC
</code></pre></div>
defining the mapping for all mass points at the same time. One can use this datacard to estimate 95%CL for different mass points by assigning <mass_value> in the command below.  </p>
<div class="highlight"><pre><span></span><code>combine -M AsymptoticLimits  -d htt_tt_9_13TeV.txt  -m &lt;mass_value&gt;
</code></pre></div>
<h2 id="simultaneous-fit-in-multiple-categories">Simultaneous fit in multiple categories</h2>
<div class="highlight"><pre><span></span><code>cd $CMSSW_BASE/src/HiggsAnalysis/CombinedLimit/data/tutorials/model_building_2024/control_regions
</code></pre></div>
<p>To combine the datacards corresponding to various (independent) regions into a single card one can use <code>combineCards.py</code>. </p>
<p><div class="highlight"><pre><span></span><code>combineCards.py htt_tt_9_13TeV=htt_tt_9_13TeV.txt htt_tt_8_13TeV=htt_tt_8_13TeV.txt &gt;htt_tt_SRs.txt
</code></pre></div>
The combined card <code>htt_tt_SRs.txt</code> now has two categories: 
<div class="highlight"><pre><span></span><code>----------------------------------------------------------------------------------------------------------------------------------
bin          htt_tt_9_13TeV  htt_tt_8_13TeV
observation  3416            105545
----------------------------------------------------------------------------------------------------------------------------------
</code></pre></div></p>
<h2 id="rate-parameters">Rate parameters</h2>
<div class="highlight"><pre><span></span><code>cd $CMSSW_BASE/src/HiggsAnalysis/CombinedLimit/data/tutorials/model_building_2024/control_regions
</code></pre></div>
<p>It is quite common to use data-drive background estimation methods. In Combine one can perform simultaneous fit of signal and control regions it allows to automatically handle the statistical uncertainty due to the number of data events in the control region, correctly handles signal contamination in the control region, allows to properly take into account systematic uncertainties affecting the backgrounds in the control regions. </p>
<p>In the working directory for this section you can find the <code>htt_zmm_8_13TeV.txt, htt_zmm_9_13TeV.txt and htt_ttbar_1_13TeV.txt</code> cards, corresponding to the control regions enriched in ZLL and ttbar processes, in addition to the signal regions from the previous step. Let's combine all of the regions into one datacard. </p>
<p><div class="highlight"><pre><span></span><code>combineCards.py htt_zmm_9_13TeV=htt_zmm_9_13TeV.txt htt_zmm_8_13TeV=htt_zmm_8_13TeV.txt htt_ttbar_1_13TeV=htt_ttbar_1_13TeV.txt htt_tt_9_13TeV=htt_tt_9_13TeV.txt htt_tt_8_13TeV=htt_tt_8_13TeV.txt &gt;htt_tt_combined.txt
</code></pre></div>
Now the <code>htt_tt_combined.txt</code> contains signal and control regions. To allow the rate of the background processes to be corrected from the control regions we can define common rate parameters, which linearly scale the predicted rates specified in the datacard, using the syntax </p>
<div class="highlight"><pre><span></span><code>&lt;rate_param_name&gt; rateParam &lt;category&gt; &lt;process&gt; &lt;initial_value&gt; [min_value,max_value]
</code></pre></div>
<p>The following lines define <code>rate_TT</code> and <code>rate_ZMM</code> rate parameters scaling TT and ZLL processes in all regions simultaneously: 
<div class="highlight"><pre><span></span><code>rate_TT                 rateParam  *          TT         1 [0,5]
rate_TT                 rateParam  *          TTT        1 [0,5]
rate_ZMM                rateParam  *          ZLL        1 [0,2]
</code></pre></div></p>
<p>Note that by default rate parameters are freely floating (unconstrained) parameters in Combine, however it is possible to add a constrain term to the likelihood by adding the <code>param</code> modifier with the same name as rate parameter: </p>
<p><div class="highlight"><pre><span></span><code>rate_TT param &lt;mean&gt; &lt;sigma&gt;  
</code></pre></div>
<strong>Task:</strong> Add <code>param</code> nuisance named <code>rate_TT</code> with <code>mean = 1.</code> and <code>sigma = 1</code>, check how the uncertainty on <code>rate_TT</code> parameter changes, what happens if you change the width of the constraint term?</p>
<p>In addition modifiers that are functions of other parameters can be included using the following syntax:</p>
<p><div class="highlight"><pre><span></span><code>name rateParam bin process formula args
</code></pre></div>
This can be useful to constrain the ratio of two processes as shown below</p>
<div class="highlight"><pre><span></span><code>rate_A rateParam *  process_A 
ratio_BtoA param 1 1
rate_B rateParam *  process_B  @0*@1 rate_A*ratio
</code></pre></div>
<h2 id="extra-arguments">Extra arguments</h2>
<div class="highlight"><pre><span></span><code>cd $CMSSW_BASE/src/HiggsAnalysis/CombinedLimit/data/tutorials/model_building_2024/PhysicsModels
</code></pre></div>
<p>In one wants to connect different models with common parameters, or just use external functions it is possible to import parameters defined within external workspaces with <code>extArg</code>: </p>
<p><div class="highlight"><pre><span></span><code>name extArg rootfile:workspacename
</code></pre></div>
The <code>extArg</code> syntax allows to import <code>RooAbsReal</code> object from an external workspace. This object can be another free floating parameter, or a function of other parameters. In this section we are going to import <code>RooSpline1D</code> objects which define how various Higgs production cross sections depend on the Higgs mass (<code>MH</code> parameter). </p>
<p>The datacard we are going to use in this section <code>htt_tt_125_8TeV.txt</code> correspond to 8 TeV analysis and Higgs mass of 125 GeV. To excercise the <code>extArg</code> features, let's rescale the signal templates to 13 TeV cross section values. 
The 13 and 8 TeV cross sections predictions from YR4 are stored in the <code>$CMSSW_BASE/src/HiggsAnalysis/CombinedLimit/data/lhc-hxswg/sm/</code>
in <code>sm_yr4_13TeV.root</code> and <code>sm_yr4_8TeV.root</code> files respectively, let's inspect the contents of <code>sm_yr4_13TeV.root</code>: </p>
<p><div class="highlight"><pre><span></span><code> TFile*     /afs/cern.ch/work/a/anigamov/rootv630/CMSSW_14_1_0_pre4/src/HiggsAnalysis/CombinedLimit/data/lhc-hxswg/sm/sm_yr4_13TeV.root 
  KEY: RooWorkspace xs_13TeV;1  xs_13TeV
  KEY: TProcessID   ProcessID0;1    2fd49e90-f1a0-11e8-9717-b052b8bcbeef
root [2] xs_13TeV-&gt;Print()

RooWorkspace(xs_13TeV) xs_13TeV contents

variables
---------
(MH)

functions
--------
RooSpline1D::WH_13TeV[ xvar=MH ] = 1.369
RooSpline1D::WminusH_13TeV[ xvar=MH ] = 0.5313
RooSpline1D::WplusH_13TeV[ xvar=MH ] = 0.838
RooSpline1D::ZH_13TeV[ xvar=MH ] = 0.8824
RooSpline1D::bbH_13TeV[ xvar=MH ] = 0.4863
RooSpline1D::ggH_13TeV[ xvar=MH ] = 48.52
RooSpline1D::ggZH_13TeV[ xvar=MH ] = 0.1227
RooFormulaVar::qqZH_13TeV[ actualVars=(ZH_13TeV,ggZH_13TeV) formula=&quot;@0-@1&quot; ] = 0.7597
RooSpline1D::tHW_13TeV[ xvar=MH ] = 0.01517
RooSpline1D::tHq_13TeV[ xvar=MH ] = 0.07714
RooSpline1D::ttH_13TeV[ xvar=MH ] = 0.5065
RooSpline1D::vbfH_13TeV[ xvar=MH ] = 3.779
</code></pre></div>
The <code>RooSpline1D::WH_13TeV[ xvar=MH ] = 1.369</code> contains cross sections values interpolated between various Higgs mass points. 
We can import them into our model as shown below</p>
<p><div class="highlight"><pre><span></span><code>vbfH_13TeV     extArg     $CMSSW_BASE/src/HiggsAnalysis/CombinedLimit/data/lhc-hxswg/sm/sm_yr4_13TeV.root:xs_13TeV
ggH_13TeV     extArg     $CMSSW_BASE/src/HiggsAnalysis/CombinedLimit/data/lhc-hxswg/sm/sm_yr4_13TeV.root:xs_13TeV
ZH_13TeV     extArg     $CMSSW_BASE/src/HiggsAnalysis/CombinedLimit/data/lhc-hxswg/sm/sm_yr4_13TeV.root:xs_13TeV
WH_13TeV     extArg     $CMSSW_BASE/src/HiggsAnalysis/CombinedLimit/data/lhc-hxswg/sm/sm_yr4_13TeV.root:xs_13TeV

vbfH_8TeV     extArg     $CMSSW_BASE/src/HiggsAnalysis/CombinedLimit/data/lhc-hxswg/sm/sm_yr4_8TeV.root:xs_8TeV
ggH_8TeV     extArg     $CMSSW_BASE/src/HiggsAnalysis/CombinedLimit/data/lhc-hxswg/sm/sm_yr4_8TeV.root:xs_8TeV
ZH_8TeV     extArg     $CMSSW_BASE/src/HiggsAnalysis/CombinedLimit/data/lhc-hxswg/sm/sm_yr4_8TeV.root:xs_8TeV
WH_8TeV     extArg     $CMSSW_BASE/src/HiggsAnalysis/CombinedLimit/data/lhc-hxswg/sm/sm_yr4_8TeV.root:xs_8TeV
</code></pre></div>
Then we can define <code>rateParam</code> as functions of imported <code>extArg</code>s to rescale signal processes WH, ZH, ggH, qqH: 
<div class="highlight"><pre><span></span><code>WH_8to13TeV    rateParam  *   WH    @0/@1         WH_13TeV,WH_8TeV
ZH_8to13TeV    rateParam  *   ZH    @0/@1         ZH_13TeV,ZH_8TeV
ggH_8to13TeV    rateParam  *   ggH    @0/@1         ggH_13TeV,ggH_8TeV
vbfH_8to13TeV    rateParam  *   qqH    @0/@1         vbfH_13TeV,vbfH_8TeV
</code></pre></div></p>
<p>When running Combine methods (e.g. <code>combine -M MultiDimFit --algo singles</code>) with these parameters you have to freeze <code>MH</code>, i.e. add <code>--freezeParameters MH</code> option.  </p>
<p><strong>Advanced task:</strong> rescale the signal templates to the cross-section corresponding to a different MH value (e.g. 120 GeV). </p>
<h2 id="physics-models">Physics Models</h2>
<p>With physics model one can instruct Combine how to scale the signal (background) yields with parameters of the model: <span class="arithmatex">\(M_{cp}(\vec{\mu})\)</span> from </p>
<div class="arithmatex">\[n^\mathrm{exp}_{cb} = \mathrm{max}(0, \sum_{p} M_{cp}(\vec{\mu})N_{cp}(\nu_G, \vec{\nu}_L,\vec{\nu}_S,\vec{\nu}_{\rho})\omega_{cbp}(\vec{\nu}_S) + E_{cb}(\vec{\nu}_B) ) \]</div>
<p>In Combine we can use <a href="https://github.com/cms-analysis/HiggsAnalysis-CombinedLimit/blob/main/python/PhysicsModel.py#L16">PhysicsModel</a> as a base class.</p>
<p>This class has several useful methods, but the most important ones are <code>doParametersOfInterest()</code> which defines parameters and functions of the model, and <code>getYieldScale(self, bin, process)</code> defines how expected events are scaled with the model parameters.</p>
<div class="highlight"><pre><span></span><code>class PhysicsModelBase(six.with_metaclass(ABCMeta, object)):
...
    def doParametersOfInterest(self):
        &quot;&quot;&quot;Create POI and other parameters, and define the POI set.&quot;&quot;&quot;

    def getYieldScale(self, bin, process):
        &quot;Return the name of a RooAbsReal to scale this yield by or the two special values 1 and 0 (don&#39;t scale, and set to zero)&quot;
        return &quot;r&quot; if self.DC.isSignal[process] else 1
...
</code></pre></div>
<p>There are many models available to use for different physics cases, follow the <a href="https://cms-analysis.github.io/HiggsAnalysis-CombinedLimit/latest/part2/physicsmodels/">link</a> for more information. In the following sections we will discuss how one can construct custom models. </p>
<p>To use a different physics model instead of the default one, we are going to use the option -P as in</p>
<div class="highlight"><pre><span></span><code>text2workspace.py datacard.txt -P HiggsAnalysis.CombinedLimit.PythonFile:modelName
</code></pre></div>
<h3 id="default-physics-model">Default physics model</h3>
<p>The default physics model implemented in Combine defines a single POI that linearly scales all signal processes. We use this model by default when running <code>text2workspace.py -m &lt;mass_value&gt; &lt;datacard.txt&gt;</code>. </p>
<div class="arithmatex">\[
M_{cp}(\mu) = \begin{cases}
    \mu  &amp;\mathrm{if\ } p \in \mathrm{signal} \\
    1    &amp;\mathrm{otherwise} \end{cases}
\]</div>
<div class="highlight"><pre><span></span><code>class PhysicsModel(PhysicsModelBase):
    &quot;&quot;&quot;Example class with signal strength as only POI&quot;&quot;&quot;

    def doParametersOfInterest(self):
        &quot;&quot;&quot;Create POI and other parameters, and define the POI set.&quot;&quot;&quot;
        self.modelBuilder.doVar(&quot;r[1,0,20]&quot;)
        self.modelBuilder.doSet(&quot;POI&quot;, &quot;r&quot;)
        # --- Higgs Mass as other parameter ----
        if self.options.mass != 0:
            if self.modelBuilder.out.var(&quot;MH&quot;):
                self.modelBuilder.out.var(&quot;MH&quot;).removeRange()
                self.modelBuilder.out.var(&quot;MH&quot;).setVal(self.options.mass)
            else:
                self.modelBuilder.doVar(&quot;MH[%g]&quot; % self.options.mass)
</code></pre></div>
<h3 id="multi-signal-model">Multi Signal model</h3>
<p>Combine already contains a model <a href="https://cms-analysis.github.io/HiggsAnalysis-CombinedLimit/latest/part2/physicsmodels/#multisignalmodel-ready-made-model-for-multiple-signal-processes"><code>HiggsAnalysis.CombinedLimit.PhysicsModel:multiSignalModel</code></a> that can be used to assign different signal strengths to multiple processes in a datacard, configurable from the command line using the mapping <code>--PO 'map=&lt;bin&gt;/&lt;process&gt;:&lt;parameter_name&gt;'</code>. The wildcard <code>*</code> are allowed for <code>&lt;bin&gt;</code> and <code>&lt;process&gt;</code> entries. The following command assigns <code>r_ggH</code> signal strength to scale <code>ggH</code> processes in all regions (<code>bin</code>s). </p>
<div class="highlight"><pre><span></span><code>text2workspace.py -P HiggsAnalysis.CombinedLimit.PhysicsModel:multiSignalModel  --PO verbose  --PO  &#39;map=.*/ggH:r_ggH[1,-5,5]&#39; --PO &#39;map=.*/qqH:r_qqH[1,-5,5]&#39; PhysicsModel/htt_tt_125_8TeV.txt  -o ws_multiSignal.root -m 125
combine -M MultiDimFit --algo singles -d  ws_multiSignal.root -n .multiSignal.
</code></pre></div>
<h3 id="custom-models">Custom models</h3>
<p>Now let's look at the example of how one can construct a model where the two leading signal processes (qqH and ggH) are scaled with relative fraction parameter <code>f</code> and the overall rate modifier <code>r</code>. </p>
<div class="arithmatex">\[
N_{qqH}(r, f) = r f N_{qqH};\,N_{ggH}(r, f) = r (1 - f) N_{ggH}
\]</div>
<p>As discussed above first we have to define the parameters of the model
<div class="highlight"><pre><span></span><code>    def doParametersOfInterest(self):
        &quot;&quot;&quot;Create POI and other parameters, and define the POI set.&quot;&quot;&quot;
        self.modelBuilder.doVar(&quot;f[0,0,4]&quot;) 
        self.modelBuilder.doVar(&quot;r[1,0,10]&quot;)
</code></pre></div>
then we can use the in the scaling functions for ggH and qqH processes
<div class="highlight"><pre><span></span><code>        self.modelBuilder.factory_( &quot;expr::scale_qqH(\&quot;(1-@0)*@1\&quot;, f,r)&quot;)
        self.modelBuilder.factory_( &quot;expr::scale_ggH(\&quot;@0*@1\&quot;, f,r)&quot;)
</code></pre></div>
add the parameters to the set of POIs
<div class="highlight"><pre><span></span><code>        self.modelBuilder.doSet(&quot;POI&quot;, &quot;,&quot;.join([&quot;f&quot;]))
        self.modelBuilder.doSet(&quot;POI&quot;, &quot;,&quot;.join([&quot;r&quot;]))
</code></pre></div>
The <code>getYieldScale(self, bin, process)</code> method will scale <code>qqH</code> process with the <code>scale_qqH</code> object and <code>ggH</code> with <code>scale_ggH</code>. 
<div class="highlight"><pre><span></span><code>    def getYieldScale(self, bin, process):
        if process == &quot;qqH&quot;: return &quot;scale_qqH&quot;
        elif process == &quot;ggH&quot;: return &quot;scale_ggH&quot;
        else: return 1
</code></pre></div></p>
<p>To use this model we should add the directory where the corresponding file is located to the <code>PYTHON3PATH</code>:
<div class="highlight"><pre><span></span><code>export PYTHON3PATH=${PYTHON3PATH}:${PWD}/models
</code></pre></div>
And now we can finally create the workspace using this model: 
<div class="highlight"><pre><span></span><code>text2workspace.py PhysicsModels/htt_tt_125_8TeV.txt -P FractionModel:Fraction_2signals  -m 125  -o ws_fraction.root
</code></pre></div></p>
<p>One can inspect the created workspace to ensure that the model is correctly implemented</p>
<div class="highlight"><pre><span></span><code>root -l ws_fraction.root
root [1] w-&gt;Print()
</code></pre></div>
<p>The created workspace is quite large, but it should have two new <code>RooFormulaVar</code> objects </p>
<p><div class="highlight"><pre><span></span><code>RooFormulaVar::scale_ggH[ actualVars=(f,r) formula=&quot;x[0]*x[1]&quot; ] = 0
RooFormulaVar::scale_qqH[ actualVars=(f,r) formula=&quot;(1-x[0])*x[1]&quot; ] = 1
</code></pre></div>
which modify the normalisation of the ggH and qqH processes</p>
<div class="highlight"><pre><span></span><code>ProcessNormalization::n_exp_binhtt_tt_1_8TeV_proc_ggH[ thetaList=(CMS_eff_t_tt_8TeV,CMS_htt_scale_met_8TeV,QCDscale_ggH1in,UEPS,lumi_8TeV,pdf_gg) asymmThetaList=() otherFactorList=(scale_ggH) ] = 0
ProcessNormalization::n_exp_binhtt_tt_1_8TeV_proc_qqH[ thetaList=(CMS_eff_t_tt_8TeV,CMS_htt_scale_met_8TeV,CMS_scale_j_8TeV,QCDscale_qqH,UEPS,lumi_8TeV,pdf_qqbar) asymmThetaList=() otherFactorList=(scale_qqH) ] = 1.4954
</code></pre></div>
<h3 id="eft-model">EFT model</h3>
<p>One can also define analytical BSM models with Combine. In this section we will extract the CI for one of the SMEFT Wilson coefficient. Without going into details, it can be shown that the dimension-6 SMEFT operators scale with quadratic equations. In this example will consider the <span class="arithmatex">\(c_{Hg}\)</span> operator that among all signal processes in the datacard affects only ggH at the LO in SMEFT. </p>
<p><span class="arithmatex">\(\sigma(c_{g}) = \sigma_{SM} (1 + A c_{g} + B c^{2}_{g})\)</span>, where A and B coefficients are numbers that can be estimated from simulation.</p>
<div class="highlight"><pre><span></span><code>class SMEFT_chg(PhysicsModel):
    def doParametersOfInterest(self):
        &quot;&quot;&quot;Create POI and other parameters, and define the POI set.&quot;&quot;&quot;
        self.modelBuilder.doVar(&quot;A[39.54]&quot;)
        self.modelBuilder.doVar(&quot;B[245.32]&quot;)
    self.modelBuilder.out.var(&quot;A&quot;).setConstant(True) 
    self.modelBuilder.out.var(&quot;B&quot;).setConstant(True)
        self.modelBuilder.doVar(&quot;chg[0,-1,1]&quot;)
        self.modelBuilder.factory_( &quot;expr::ggH_scaling_chg(\&quot;1+@1*@0+@2*@0*@0\&quot;, chg, A, B)&quot;)
    self.modelBuilder.doSet(&quot;POI&quot;, &quot;,&quot;.join([&quot;chg&quot;]))

    def getYieldScale(self, bin, process):
        if process == &quot;ggH&quot;: return &quot;ggH_scaling_chg&quot;
        else: return 1

smeft_chg_tutorial = SMEFT_chg()
</code></pre></div>
<p>To create the workspace using this model one can run </p>
<div class="highlight"><pre><span></span><code>export PYTHON3PATH=${PYTHON3PATH}:${PWD}/models
text2workspace.py PhysicsModels/htt_tt_125_8TeV.txt -P EFT_simple:smeft_chg_tutorial  -m 125  -o ws_chg.root
</code></pre></div>
<p>Run the likelihood scan for <span class="arithmatex">\(c_{Hg}\)</span> parameter and make the plot:
<div class="highlight"><pre><span></span><code>combine -M MultiDimFit --algo grid -d  ws_chg.root --setParameterRanges chg=-0.2,0.2
plot1DScan.py higgsCombineTest.MultiDimFit.mH120.root --POI chg
</code></pre></div></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../../tutorial_stat_routines/stat_routines/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Statitiscal Tests Basics">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Statitiscal Tests Basics
              </div>
            </div>
          </a>
        
        
          
          <a href="../../abcd_rooparametrichist_tutorial/rooparametrichist_exercise/" class="md-footer__link md-footer__link--next" aria-label="Next: Per-bin Transfer Factors with Parametric Histograms">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Per-bin Transfer Factors with Parametric Histograms
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "navigation.footer", "navigation.indexes", "navigation.expand", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "search.highlight", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>