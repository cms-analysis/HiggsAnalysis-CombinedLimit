
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../part5/longexerciseanswers/">
      
      
        <link rel="next" href="../../tutorial2023_unfolding/unfolding_exercise/">
      
      
      <link rel="icon" href="../../logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>Parametric Models - Combine</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2afb09e1.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../mystyle.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#parametric-models-in-combine" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
  You're not viewing the latest version.
  <a href="../../.."> 


    <strong>Click here to go to latest.</strong>
  </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),base=new URL("../.."),outdated=__md_get("__outdated",sessionStorage,base);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Combine" class="md-header__button md-logo" aria-label="Combine" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Combine
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Parametric Models
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/cms-analysis/HiggsAnalysis-CombinedLimit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../what_combine_does/introduction/" class="md-tabs__link">
          
  
  
    
  
  What Combine Does

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../part2/settinguptheanalysis/" class="md-tabs__link">
          
  
  
    
  
  Setting up the analysis

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../part3/runningthetool/" class="md-tabs__link">
          
  
  
    
  
  Running combine

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../part5/roofit/" class="md-tabs__link">
          
  
  
    
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../part4/usefullinks/" class="md-tabs__link">
        
  
  
    
  
  Links & FAQ

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Combine" class="md-nav__button md-logo" aria-label="Combine" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    Combine
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/cms-analysis/HiggsAnalysis-CombinedLimit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    What Combine Does
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            What Combine Does
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../what_combine_does/introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../what_combine_does/model_and_likelihood/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Model and Likelihood
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../what_combine_does/fitting_concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fitting Concepts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../what_combine_does/statistical_tests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Statistical Tests
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Setting up the analysis
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Setting up the analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/settinguptheanalysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Preparing the datacard
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Physics models
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Physics models
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/physicsmodels/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/higgscouplings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SM Higgs coupling models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/bsm-higgs-models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BSM Higgs models
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/bin-wise-stats/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Automatic MC statistical uncertainties
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Running combine
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Running combine
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/runningthetool/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Running the tool
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/commonstatsmethods/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Common statistical methods
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/nonstandard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Advanced use cases
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/simplifiedlikelihood/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Simplified Likelihoods
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/regularisation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Unfolding & regularization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Validating datacards
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part3/debugging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Debugging fit failures
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/roofit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RooFit Basics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Main Features
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Main Features
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/longexercise/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exercises
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/longexerciseanswers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Solutions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Parametric Models
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Parametric Models
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    <span class="md-ellipsis">
      Getting started
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#session-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Session structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jupyter-notebooks" class="md-nav__link">
    <span class="md-ellipsis">
      Jupyter notebooks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analysis-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Analysis overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-1-parametric-model-building" class="md-nav__link">
    <span class="md-ellipsis">
      Part 1: Parametric model building
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 1: Parametric model building">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#signal-modelling" class="md-nav__link">
    <span class="md-ellipsis">
      Signal modelling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#background-modelling" class="md-nav__link">
    <span class="md-ellipsis">
      Background modelling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datacard" class="md-nav__link">
    <span class="md-ellipsis">
      Datacard
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extension-signal-normalisation-object" class="md-nav__link">
    <span class="md-ellipsis">
      Extension: signal normalisation object
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extension-unbinned-vs-binned" class="md-nav__link">
    <span class="md-ellipsis">
      Extension: unbinned vs binned
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-2-simple-fits" class="md-nav__link">
    <span class="md-ellipsis">
      Part 2: Simple fits
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 2: Simple fits">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#confidence-intervals" class="md-nav__link">
    <span class="md-ellipsis">
      Confidence intervals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extension-expected-fits" class="md-nav__link">
    <span class="md-ellipsis">
      Extension: expected fits
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extension-goodness-of-fit-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Extension: goodness-of-fit tests
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-3-systematic-uncertainties" class="md-nav__link">
    <span class="md-ellipsis">
      Part 3: Systematic uncertainties
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 3: Systematic uncertainties">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parametric-shape-uncertainties" class="md-nav__link">
    <span class="md-ellipsis">
      Parametric shape uncertainties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uncertainty-breakdown" class="md-nav__link">
    <span class="md-ellipsis">
      Uncertainty breakdown
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#impacts" class="md-nav__link">
    <span class="md-ellipsis">
      Impacts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-4-toy-generation-and-bias-studies" class="md-nav__link">
    <span class="md-ellipsis">
      Part 4: Toy generation and bias studies
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 4: Toy generation and bias studies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bias-studies" class="md-nav__link">
    <span class="md-ellipsis">
      Bias studies
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-5-discrete-profiling" class="md-nav__link">
    <span class="md-ellipsis">
      Part 5: Discrete-profiling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-6-multi-signal-model" class="md-nav__link">
    <span class="md-ellipsis">
      Part 6: Multi-signal model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 6: Multi-signal model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#building-the-models" class="md-nav__link">
    <span class="md-ellipsis">
      Building the models
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-fits" class="md-nav__link">
    <span class="md-ellipsis">
      Running the fits
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#two-dimensional-likelihood-scan" class="md-nav__link">
    <span class="md-ellipsis">
      Two-dimensional likelihood scan
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#correlations-between-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Correlations between parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#impacts_1" class="md-nav__link">
    <span class="md-ellipsis">
      Impacts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-exercises-to-be-added" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced exercises (to be added)
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial2023_unfolding/unfolding_exercise/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Likelihood Based Unfolding
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial_stat_routines/stat_routines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Statitiscal Tests Basics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../model_building_tutorial2024/model_building_exercise/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Model building
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../abcd_rooparametrichist_tutorial/rooparametrichist_exercise/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Per-bin Transfer Factors with Parametric Histograms
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/usefullinks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Links & FAQ
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    <span class="md-ellipsis">
      Getting started
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#session-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Session structure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jupyter-notebooks" class="md-nav__link">
    <span class="md-ellipsis">
      Jupyter notebooks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analysis-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Analysis overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-1-parametric-model-building" class="md-nav__link">
    <span class="md-ellipsis">
      Part 1: Parametric model building
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 1: Parametric model building">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#signal-modelling" class="md-nav__link">
    <span class="md-ellipsis">
      Signal modelling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#background-modelling" class="md-nav__link">
    <span class="md-ellipsis">
      Background modelling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datacard" class="md-nav__link">
    <span class="md-ellipsis">
      Datacard
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extension-signal-normalisation-object" class="md-nav__link">
    <span class="md-ellipsis">
      Extension: signal normalisation object
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extension-unbinned-vs-binned" class="md-nav__link">
    <span class="md-ellipsis">
      Extension: unbinned vs binned
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-2-simple-fits" class="md-nav__link">
    <span class="md-ellipsis">
      Part 2: Simple fits
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 2: Simple fits">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#confidence-intervals" class="md-nav__link">
    <span class="md-ellipsis">
      Confidence intervals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extension-expected-fits" class="md-nav__link">
    <span class="md-ellipsis">
      Extension: expected fits
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extension-goodness-of-fit-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Extension: goodness-of-fit tests
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-3-systematic-uncertainties" class="md-nav__link">
    <span class="md-ellipsis">
      Part 3: Systematic uncertainties
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 3: Systematic uncertainties">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parametric-shape-uncertainties" class="md-nav__link">
    <span class="md-ellipsis">
      Parametric shape uncertainties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uncertainty-breakdown" class="md-nav__link">
    <span class="md-ellipsis">
      Uncertainty breakdown
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#impacts" class="md-nav__link">
    <span class="md-ellipsis">
      Impacts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-4-toy-generation-and-bias-studies" class="md-nav__link">
    <span class="md-ellipsis">
      Part 4: Toy generation and bias studies
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 4: Toy generation and bias studies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bias-studies" class="md-nav__link">
    <span class="md-ellipsis">
      Bias studies
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-5-discrete-profiling" class="md-nav__link">
    <span class="md-ellipsis">
      Part 5: Discrete-profiling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-6-multi-signal-model" class="md-nav__link">
    <span class="md-ellipsis">
      Part 6: Multi-signal model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 6: Multi-signal model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#building-the-models" class="md-nav__link">
    <span class="md-ellipsis">
      Building the models
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-fits" class="md-nav__link">
    <span class="md-ellipsis">
      Running the fits
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#two-dimensional-likelihood-scan" class="md-nav__link">
    <span class="md-ellipsis">
      Two-dimensional likelihood scan
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#correlations-between-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Correlations between parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#impacts_1" class="md-nav__link">
    <span class="md-ellipsis">
      Impacts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-exercises-to-be-added" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced exercises (to be added)
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="parametric-models-in-combine">Parametric Models in Combine</h1>
<h2 id="getting-started">Getting started</h2>
<p>To get started, you should have a working setup of <code>Combine</code>, please follow the instructions from the <a href="https://cms-analysis.github.io/HiggsAnalysis-CombinedLimit/latest/#within-cmssw-recommended-for-cms-users">home page</a>. Make sure to use the latest recommended release.</p>
<p>Now let's move to the working directory for this tutorial which contains all of the inputs and scripts needed to run the parametric fitting exercise:
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span><span class="nv">$CMSSW_BASE</span>/src/HiggsAnalysis/CombinedLimit/data/tutorials/parametric_exercise
</code></pre></div></p>
<h2 id="session-structure">Session structure</h2>
<p>The exercise is split into six parts which cover:</p>
<p>1) Parametric model building</p>
<p>2) Simple fits</p>
<p>3) Systematic uncertainties</p>
<p>4) Toy generation</p>
<p>5) Discrete profiling</p>
<p>6) Multi-signal hypothesis</p>
<p>Throughout the tutorial there are a number of questions and exercises for you to complete. These are shown by the bullet points in this markdown file.</p>
<p>All the code required to run the different parts is available in python scripts. We have purposely <strong>commented out the code</strong> to encourage you to open the scripts and take a look what is inside. Each block is separated by a divider and a blank line. When you are happy and understand the code, you can uncomment (block by block) and then run the scripts (using python3) e.g.:
<div class="highlight"><pre><span></span><code>python3<span class="w"> </span>construct_models_part1.py
</code></pre></div>
A number of scripts will produce plots (as .png files). The default path to store these plots is in the current working directory. You can change this (e.g. pipe to an eos webpage) by changing the <code>plot_dir</code> variable in the <code>config.py</code> script.</p>
<p>There's also a set of combine (.txt) datacards which will help you get through the various parts of the exercise. The exercises should help you become familiar with the structure of parametric fitting datacards.</p>
<p>Finally, this exercise is heavily based off the <code>RooFit</code> package. So if you find yourself using the python interpreter for any checks, don't forget to...
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">ROOT</span>
</code></pre></div></p>
<h2 id="jupyter-notebooks">Jupyter notebooks</h2>
<p>Alternatively, we have provided <code>Jupyter</code> notebooks to run the different parts of the exercise e.g. <code>part1.ipynb</code>. You will have already downloaded these notebooks when cloning the tutorial gitlab repo. To open Jupyter notebooks on lxplus <strong>within a CMSSW environment</strong>, you can add the following option when you <code>ssh</code> into lxplus:
<div class="highlight"><pre><span></span><code>ssh<span class="w"> </span>-X<span class="w"> </span>-Y<span class="w"> </span>username@lxplus.cern.ch<span class="w"> </span>-L8xxx:localhost:8xxx
</code></pre></div>
where you should replace <code>xxx</code> with some three digit number. Then <code>cd</code> into the <code>combinetutorial-2023-parametric</code> directory and set up the CMSSW environment with:
<div class="highlight"><pre><span></span><code>cmsenv
</code></pre></div>
You can then open the Jupyter notebook inside the environment with:
<div class="highlight"><pre><span></span><code>jupyter<span class="w"> </span>notebook<span class="w"> </span>--no-browser<span class="w"> </span>--port<span class="w"> </span>8xxx
</code></pre></div>
replacing <code>xxx</code> with the same three digit number. You should now be able to copy the url it provides into a browser and access the various exercise notebooks.</p>
<h2 id="analysis-overview">Analysis overview</h2>
<p>In this exercise we will look at one of the most famous parametric fitting analyses at the LHC: the Higgs boson decaying to two photons (H <span class="arithmatex">\(\rightarrow \gamma\gamma\)</span>). This decay channel is key in understanding the properties of the Higgs boson due to its clean final state topology. The excellent energy resolution- of the CMS electromagnetic calorimeter leads to narrow signal peak in the diphoton invariant mass spectrum, <span class="arithmatex">\(m_{\gamma\gamma}\)</span>, above a smoothly falling background continuum. The mass spectrum for the <a href="http://cms-results.web.cern.ch/cms-results/public-results/publications/HIG-19-015/index.html">legacy Run 2 analysis</a> is shown below.</p>
<p><img alt="" src="../plots/overview.png" /></p>
<p>In the analysis, we construct parametric models (analytic functions) of both signal and background events to fit the <span class="arithmatex">\(m_{\gamma\gamma}\)</span> spectrum in data. From the fit we can extract measurements of Higgs boson properties including its rate of production, its mass (<span class="arithmatex">\(m_H\)</span>), its coupling behaviour, to name a few. This exercise will show how to construct parametric models using RooFit, and subsequently how to use combine to extract the results.</p>
<h2 id="part-1-parametric-model-building">Part 1: Parametric model building</h2>
<p>As with any fitting exercise, the first step is to understand the format of the input data, explore its contents and construct a model. The python script which performs the model construction is <code>construct_models_part1.py</code>. This section will explain what the various lines of code are doing. If you are not very familiar with <code>RooFit</code>, you may want to refer to our <code>RooFit</code> Basics tutorial  <a href="https://cms-analysis.github.io/HiggsAnalysis-CombinedLimit/latest/part5/roofit/">here</a>.</p>
<h3 id="signal-modelling">Signal modelling</h3>
<p>Firstly, we will construct a model to fit the signal (H <span class="arithmatex">\(\rightarrow\gamma\gamma\)</span>) mass peak using a Monte Carlo simulation sample of gluon-gluon fusion production (ggH) events with <span class="arithmatex">\(m_H=125\)</span> GeV. This production mode has the largest cross section in the SM, and the LO Feynman diagram is shown below.</p>
<p><img alt="" src="../plots/part1_feynman.png" /></p>
<p>There has already been a dedicated selection performed on the events to increase the signal-to-background ratio (e.g. using some ML event classifier). Events passing this selection enter the analysis category, Tag0. Events entering Tag0 are used for the parametric fitting of the <span class="arithmatex">\(m_{\gamma\gamma}\)</span> spectrum.</p>
<p>The events are stored in a ROOT <code>TTree</code>, where the diphoton mass, <code>CMS_hgg_mass</code>, and the event weight, <code>weight</code>, are saved. Let's begin by loading the MC, and converting the <code>TTree</code> data into <code>RooDataSet</code>:
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">ROOT</span>
<span class="n">ROOT</span><span class="o">.</span><span class="n">gROOT</span><span class="o">.</span><span class="n">SetBatch</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TFile</span><span class="p">(</span><span class="s2">&quot;mc_part1.root&quot;</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="c1"># Load TTree</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s2">&quot;ggH_Tag0&quot;</span><span class="p">)</span>

<span class="c1"># Define mass and weight variables</span>
<span class="n">mass</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooRealVar</span><span class="p">(</span><span class="s2">&quot;CMS_hgg_mass&quot;</span><span class="p">,</span> <span class="s2">&quot;CMS_hgg_mass&quot;</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span>
<span class="n">weight</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooRealVar</span><span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Convert to RooDataSet</span>
<span class="n">mc</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooDataSet</span><span class="p">(</span><span class="s2">&quot;ggH_Tag0&quot;</span><span class="p">,</span><span class="s2">&quot;ggH_Tag0&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooArgSet</span><span class="p">(</span><span class="n">mass</span><span class="p">,</span><span class="n">weight</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span> <span class="p">)</span>

<span class="c1"># Lets plot the signal mass distribution</span>
<span class="n">can</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TCanvas</span><span class="p">()</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">mass</span><span class="o">.</span><span class="n">frame</span><span class="p">()</span>
<span class="n">mc</span><span class="o">.</span><span class="n">plotOn</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>
<span class="n">plot</span><span class="o">.</span><span class="n">Draw</span><span class="p">()</span>
<span class="n">can</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
<span class="n">can</span><span class="o">.</span><span class="n">SaveAs</span><span class="p">(</span><span class="s2">&quot;part1_signal_mass.png&quot;</span><span class="p">)</span>
</code></pre></div></p>
<p><img alt="" src="../plots/part1_signal_mass.png" /></p>
<p>The plot shows a peak centred on the Higgs mass at 125 GeV. Let's use a simple Gaussian to model the peak.
<div class="highlight"><pre><span></span><code><span class="c1"># Introduce a RooRealVar into the workspace for the Higgs mass</span>
<span class="n">MH</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooRealVar</span><span class="p">(</span><span class="s2">&quot;MH&quot;</span><span class="p">,</span> <span class="s2">&quot;MH&quot;</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">130</span> <span class="p">)</span>
<span class="n">MH</span><span class="o">.</span><span class="n">setConstant</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Signal peak width</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooRealVar</span><span class="p">(</span><span class="s2">&quot;sigma_ggH_Tag0&quot;</span><span class="p">,</span> <span class="s2">&quot;sigma_ggH_Tag0&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="c1"># Define the Gaussian with mean=MH and width=sigma</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooGaussian</span><span class="p">(</span> <span class="s2">&quot;model_ggH_Tag0&quot;</span><span class="p">,</span> <span class="s2">&quot;model_ggH_Tag0&quot;</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">MH</span><span class="p">,</span> <span class="n">sigma</span> <span class="p">)</span>

<span class="c1"># Fit Gaussian to MC events and plot</span>
<span class="n">model</span><span class="o">.</span><span class="n">fitTo</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span><span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">SumW2Error</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>

<span class="n">can</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TCanvas</span><span class="p">()</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">mass</span><span class="o">.</span><span class="n">frame</span><span class="p">()</span>
<span class="n">mc</span><span class="o">.</span><span class="n">plotOn</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">plotOn</span><span class="p">(</span> <span class="n">plot</span><span class="p">,</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">LineColor</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
<span class="n">plot</span><span class="o">.</span><span class="n">Draw</span><span class="p">()</span>
<span class="n">can</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
<span class="n">can</span><span class="o">.</span><span class="n">Draw</span><span class="p">()</span>
<span class="n">can</span><span class="o">.</span><span class="n">SaveAs</span><span class="p">(</span><span class="s2">&quot;part1_signal_model_v0.png&quot;</span><span class="p">)</span>
</code></pre></div></p>
<p><img alt="" src="../plots/part1_signal_model_v0.png" /></p>
<p>It looks like a good fit!</p>
<p><strong>Tasks and questions:</strong></p>
<ul>
<li>Run the code above for yourself (or uncomment the relevant sections in <code>python3 construct_models_part1.py</code>) to produce the plots of the signal mass distribution and the signal model.</li>
<li>Do you understand the output from the <code>fitTo</code> command (i.e the mimimization)? From now on we will add the option <code>ROOT.RooFit.PrintLevel(-1)</code> when fitting the models to surpress the minimizer output.</li>
</ul>
<p>But what if the mean of the model does not correspond directly to the Higgs boson mass i.e. there are some reconstruction effects. Let's instead define the mean of the model as:</p>
<div class="arithmatex">\[\mu = m_H + \delta\]</div>
<p>and we can fit for <span class="arithmatex">\(\delta\)</span> in the model construction. For this we introduce a <code>RooFormulaVar</code>.
<div class="highlight"><pre><span></span><code><span class="n">dMH</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooRealVar</span><span class="p">(</span><span class="s2">&quot;dMH_ggH_Tag0&quot;</span><span class="p">,</span> <span class="s2">&quot;dMH_ggH_Tag0&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
<span class="n">mean</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFormulaVar</span><span class="p">(</span><span class="s2">&quot;mean_ggH_Tag0&quot;</span><span class="p">,</span> <span class="s2">&quot;mean_ggH_Tag0&quot;</span><span class="p">,</span> <span class="s2">&quot;(@0+@1)&quot;</span><span class="p">,</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooArgList</span><span class="p">(</span><span class="n">MH</span><span class="p">,</span><span class="n">dMH</span><span class="p">))</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooGaussian</span><span class="p">(</span> <span class="s2">&quot;model_ggH_Tag0&quot;</span><span class="p">,</span> <span class="s2">&quot;model_ggH_Tag0&quot;</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">sigma</span> <span class="p">)</span>

<span class="c1"># Fit the new model with a variable mean</span>
<span class="n">model</span><span class="o">.</span><span class="n">fitTo</span><span class="p">(</span><span class="n">mc</span><span class="p">,</span><span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">SumW2Error</span><span class="p">(</span><span class="kc">True</span><span class="p">),</span><span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">PrintLevel</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

<span class="c1"># Model is parametric in MH. Let&#39;s show this by plotting for different values of MH</span>
<span class="n">can</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TCanvas</span><span class="p">()</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">mass</span><span class="o">.</span><span class="n">frame</span><span class="p">()</span>
<span class="n">MH</span><span class="o">.</span><span class="n">setVal</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">plotOn</span><span class="p">(</span> <span class="n">plot</span><span class="p">,</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">LineColor</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
<span class="n">MH</span><span class="o">.</span><span class="n">setVal</span><span class="p">(</span><span class="mi">125</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">plotOn</span><span class="p">(</span> <span class="n">plot</span><span class="p">,</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">LineColor</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">)</span>
<span class="n">MH</span><span class="o">.</span><span class="n">setVal</span><span class="p">(</span><span class="mi">130</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">plotOn</span><span class="p">(</span> <span class="n">plot</span><span class="p">,</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">LineColor</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">)</span>
<span class="n">plot</span><span class="o">.</span><span class="n">Draw</span><span class="p">()</span>
<span class="n">can</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
<span class="n">can</span><span class="o">.</span><span class="n">SaveAs</span><span class="p">(</span><span class="s2">&quot;part1_signal_model_v1.png&quot;</span><span class="p">)</span>
</code></pre></div></p>
<p><img alt="" src="../plots/part1_signal_model_v1.png" /></p>
<p><strong>Tasks and questions:</strong></p>
<ul>
<li>Run the code above (or uncomment the relevant sections in the script) to produce the plots.</li>
<li>This choice of setting the shape parameters to constant means we believe our MC will perfectly model the Higgs boson events in data. Is this the case? How could we account for the MC mis-modelling in the fit? (See part 3).</li>
<li>Let's now save the model inside a <code>RooWorkspace</code>. Combine will load this model when performing the fits. Crucially, we need to freeze the fit parameters of the signal model, otherwise they will be freely floating in the final results extraction. Run the code below to save the model to a workspace.</li>
</ul>
<p><div class="highlight"><pre><span></span><code><span class="n">MH</span><span class="o">.</span><span class="n">setVal</span><span class="p">(</span><span class="mi">125</span><span class="p">)</span>
<span class="n">dMH</span><span class="o">.</span><span class="n">setConstant</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sigma</span><span class="o">.</span><span class="n">setConstant</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">f_out</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TFile</span><span class="p">(</span><span class="s2">&quot;workspace_sig.root&quot;</span><span class="p">,</span> <span class="s2">&quot;RECREATE&quot;</span><span class="p">)</span>
<span class="n">w_sig</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooWorkspace</span><span class="p">(</span><span class="s2">&quot;workspace_sig&quot;</span><span class="p">,</span><span class="s2">&quot;workspace_sig&quot;</span><span class="p">)</span>
<span class="nb">getattr</span><span class="p">(</span><span class="n">w_sig</span><span class="p">,</span> <span class="s2">&quot;import&quot;</span><span class="p">)(</span><span class="n">model</span><span class="p">)</span>
<span class="n">w_sig</span><span class="o">.</span><span class="n">Print</span><span class="p">()</span>
<span class="n">w_sig</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>
<span class="n">f_out</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
</code></pre></div>
We have successfully constructed a parametric model to fit the shape of the signal peak. But we also need to know the yield/normalisation of the ggH signal process. In the SM, the ggH event yield in Tag0 is equal to:</p>
<div class="arithmatex">\[ N = \sigma_{ggH} \cdot \mathcal{B}^{\gamma\gamma} \cdot \epsilon \cdot \mathcal{L}\]</div>
<p>Where <span class="arithmatex">\(\sigma_{ggH}\)</span> is the SM ggH cross section, <span class="arithmatex">\(\mathcal{B}^{\gamma\gamma}\)</span> is the SM branching fraction of the Higgs boson to two photons, <span class="arithmatex">\(\epsilon\)</span> is the efficiency factor and corresponds to the fraction of the total ggH events landing in the Tag0 analysis category. Finally <span class="arithmatex">\(\mathcal{L}\)</span> is the integrated luminosity.</p>
<p>In this example, the ggH MC events are normalised <strong>before any selection is performed</strong> to <span class="arithmatex">\(\sigma_{ggH} \cdot \mathcal{B}^{\gamma\gamma}\)</span>, taking the values from the <a href="https://twiki.cern.ch/twiki/bin/view/LHCPhysics/LHCHWG#Production_cross_sections_and_de">LHCHWG twiki</a>. Note this does not include the lumi scaling, which may be different to what you have in your own analyses! We can then calculate the efficiency factor, <span class="arithmatex">\(\epsilon\)</span>, by taking the sum of weights in the MC dataset and dividing through by <span class="arithmatex">\(\sigma_{ggH} \cdot \mathcal{B}^{\gamma\gamma}\)</span>. This will tell us what fraction of ggH events land in Tag0.
<div class="highlight"><pre><span></span><code><span class="c1"># Define SM cross section and branching fraction values</span>
<span class="n">xs_ggH</span> <span class="o">=</span> <span class="mf">48.58</span> <span class="c1">#in [pb]</span>
<span class="n">br_gamgam</span> <span class="o">=</span> <span class="mf">2.7e-3</span>

<span class="c1"># Calculate the efficiency and print output</span>
<span class="n">sumw</span> <span class="o">=</span> <span class="n">mc</span><span class="o">.</span><span class="n">sumEntries</span><span class="p">()</span>
<span class="n">eff</span> <span class="o">=</span> <span class="n">sumw</span><span class="o">/</span><span class="p">(</span><span class="n">xs_ggH</span><span class="o">*</span><span class="n">br_gamgam</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Efficiency of ggH events landing in Tag0 is: </span><span class="si">%.2f%%</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">eff</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>

<span class="c1"># Calculate the total yield (assuming full Run 2 lumi) and print output</span>
<span class="n">lumi</span> <span class="o">=</span> <span class="mi">138000</span>
<span class="n">N</span> <span class="o">=</span> <span class="n">xs_ggH</span><span class="o">*</span><span class="n">br_gamgam</span><span class="o">*</span><span class="n">eff</span><span class="o">*</span><span class="n">lumi</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;For 138fb^-1, total normalisation of signal is: N = xs * br * eff * lumi = </span><span class="si">%.2f</span><span class="s2"> events&quot;</span><span class="o">%</span><span class="n">N</span><span class="p">)</span>
</code></pre></div>
Gives the output:
<div class="highlight"><pre><span></span><code>Efficiency<span class="w"> </span>of<span class="w"> </span>ggH<span class="w"> </span>events<span class="w"> </span>landing<span class="w"> </span><span class="k">in</span><span class="w"> </span>Tag0<span class="w"> </span>is:<span class="w"> </span><span class="m">1</span>.00%
For<span class="w"> </span>138fb^-1,<span class="w"> </span>total<span class="w"> </span>normalisation<span class="w"> </span>of<span class="w"> </span>signal<span class="w"> </span>is:<span class="w"> </span><span class="nv">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>xs<span class="w"> </span>*<span class="w"> </span>br<span class="w"> </span>*<span class="w"> </span>eff<span class="w"> </span>*<span class="w"> </span><span class="nv">lumi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">181</span>.01<span class="w"> </span>events
</code></pre></div>
So we find 1% of all ggH events enter Tag0. And the total expected yield of ggH events in Tag0 (with lumi scaling) is <code>181.01</code>. Lets make a note of this for later!</p>
<h3 id="background-modelling">Background modelling</h3>
<p>In the H <span class="arithmatex">\(\rightarrow\gamma\gamma\)</span> analysis we construct the background model directly from data. To avoid biasing our background estimate, we remove the signal region from the model construction and fit the mass sidebands. Let's begin by loading the data <code>TTree</code> and converting to a <code>RooDataSet</code>. We will then plot the mass sidebands.
<div class="highlight"><pre><span></span><code><span class="n">f</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TFile</span><span class="p">(</span><span class="s2">&quot;data_part1.root&quot;</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s2">&quot;data_Tag0&quot;</span><span class="p">)</span>

<span class="c1"># Convert TTree to a RooDataSet</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooDataSet</span><span class="p">(</span><span class="s2">&quot;data_Tag0&quot;</span><span class="p">,</span> <span class="s2">&quot;data_Tag0&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooArgSet</span><span class="p">(</span><span class="n">mass</span><span class="p">,</span> <span class="n">weight</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">)</span>

<span class="c1"># Define mass sideband ranges on the mass variable: 100-115 and 135-180</span>
<span class="n">n_bins</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">binning</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">Binning</span><span class="p">(</span><span class="n">n_bins</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">180</span><span class="p">)</span>
<span class="n">mass</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="s2">&quot;loSB&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">115</span> <span class="p">)</span>
<span class="n">mass</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="s2">&quot;hiSB&quot;</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">180</span> <span class="p">)</span>
<span class="n">mass</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="s2">&quot;full&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">180</span> <span class="p">)</span>
<span class="n">fit_range</span> <span class="o">=</span> <span class="s2">&quot;loSB,hiSB&quot;</span>

<span class="c1"># Plot the data in the mass sidebands</span>
<span class="n">can</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TCanvas</span><span class="p">()</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">mass</span><span class="o">.</span><span class="n">frame</span><span class="p">()</span>
<span class="n">data</span><span class="o">.</span><span class="n">plotOn</span><span class="p">(</span> <span class="n">plot</span><span class="p">,</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">CutRange</span><span class="p">(</span><span class="n">fit_range</span><span class="p">),</span> <span class="n">binning</span> <span class="p">)</span>
<span class="n">plot</span><span class="o">.</span><span class="n">Draw</span><span class="p">()</span>
<span class="n">can</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
<span class="n">can</span><span class="o">.</span><span class="n">Draw</span><span class="p">()</span>
<span class="n">can</span><span class="o">.</span><span class="n">SaveAs</span><span class="p">(</span><span class="s2">&quot;part1_data_sidebands.png&quot;</span><span class="p">)</span>
</code></pre></div></p>
<p><img alt="" src="../plots/part1_data_sidebands.png" /></p>
<p>By eye, it looks like an exponential function would fit the data sidebands well.</p>
<p><strong>Tasks and questions:</strong></p>
<ul>
<li>Run the code above to produce the plot.</li>
<li>Construct the background model using a <code>RooExponential</code> and fit the data sidebands. You can use something like the code below to do this (or uncomment the relevant section of the script.)</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">alpha</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooRealVar</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">0</span> <span class="p">)</span>
<span class="n">model_bkg</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooExponential</span><span class="p">(</span><span class="s2">&quot;model_bkg_Tag0&quot;</span><span class="p">,</span> <span class="s2">&quot;model_bkg_Tag0&quot;</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">alpha</span> <span class="p">)</span>

<span class="c1"># Fit model to data sidebands</span>
<span class="n">model_bkg</span><span class="o">.</span><span class="n">fitTo</span><span class="p">(</span> <span class="n">data</span><span class="p">,</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">fit_range</span><span class="p">),</span>  <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">PrintLevel</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

<span class="c1"># Let&#39;s plot the model fit to the data</span>
<span class="n">can</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TCanvas</span><span class="p">()</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">mass</span><span class="o">.</span><span class="n">frame</span><span class="p">()</span>
<span class="c1"># We have to be careful with the normalisation as we only fit over sidebands</span>
<span class="c1"># First do an invisible plot of the full data set</span>
<span class="n">data</span><span class="o">.</span><span class="n">plotOn</span><span class="p">(</span> <span class="n">plot</span><span class="p">,</span> <span class="n">binning</span><span class="p">,</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">MarkerColor</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">LineColor</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">)</span>
<span class="n">model_bkg</span><span class="o">.</span><span class="n">plotOn</span><span class="p">(</span> <span class="n">plot</span><span class="p">,</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">NormRange</span><span class="p">(</span><span class="n">fit_range</span><span class="p">),</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="s2">&quot;full&quot;</span><span class="p">),</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">LineColor</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="n">data</span><span class="o">.</span><span class="n">plotOn</span><span class="p">(</span> <span class="n">plot</span><span class="p">,</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">CutRange</span><span class="p">(</span><span class="n">fit_range</span><span class="p">),</span> <span class="n">binning</span> <span class="p">)</span>
<span class="n">plot</span><span class="o">.</span><span class="n">Draw</span><span class="p">()</span>
<span class="n">can</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
<span class="n">can</span><span class="o">.</span><span class="n">Draw</span><span class="p">()</span>
<span class="n">can</span><span class="o">.</span><span class="n">SaveAs</span><span class="p">(</span><span class="s2">&quot;part1_bkg_model.png&quot;</span><span class="p">)</span>
</code></pre></div>
<p><img alt="" src="../plots/part1_bkg_model.png" /></p>
<p><strong>Tasks and questions:</strong></p>
<ul>
<li>As the background model is extracted from data, we want to introduce a freely floating normalisation term in the fit that enters the likelihood as an additional Poisson term (this is known as performing an extended maximum likelihood fit). We use the total number of data events (including in the signal region) as the initial prefit value of this normalisation object i.e. assuming no signal in the data. The syntax to name this normalisation object is <code>{model}_norm</code> which will the be picked up automatically by combine. Note we also allow the shape parameter to float in the final fit to data (by not setting to constant). Include the code below to include this parameter in the workspace.</li>
</ul>
<p><div class="highlight"><pre><span></span><code><span class="n">norm</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooRealVar</span><span class="p">(</span><span class="s2">&quot;model_bkg_Tag0_norm&quot;</span><span class="p">,</span> <span class="s2">&quot;Number of background events in Tag0&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">numEntries</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">data</span><span class="o">.</span><span class="n">numEntries</span><span class="p">()</span> <span class="p">)</span>
<span class="n">alpha</span><span class="o">.</span><span class="n">setConstant</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
Let's then save the background model, the normalisation object, and the data distribution to a new <code>RooWorkspace</code>:
<div class="highlight"><pre><span></span><code><span class="n">f_out</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TFile</span><span class="p">(</span><span class="s2">&quot;workspace_bkg.root&quot;</span><span class="p">,</span> <span class="s2">&quot;RECREATE&quot;</span><span class="p">)</span>
<span class="n">w_bkg</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooWorkspace</span><span class="p">(</span><span class="s2">&quot;workspace_bkg&quot;</span><span class="p">,</span><span class="s2">&quot;workspace_bkg&quot;</span><span class="p">)</span>
<span class="nb">getattr</span><span class="p">(</span><span class="n">w_bkg</span><span class="p">,</span> <span class="s2">&quot;import&quot;</span><span class="p">)(</span><span class="n">data</span><span class="p">)</span>
<span class="nb">getattr</span><span class="p">(</span><span class="n">w_bkg</span><span class="p">,</span> <span class="s2">&quot;import&quot;</span><span class="p">)(</span><span class="n">norm</span><span class="p">)</span>
<span class="nb">getattr</span><span class="p">(</span><span class="n">w_bkg</span><span class="p">,</span> <span class="s2">&quot;import&quot;</span><span class="p">)(</span><span class="n">model_bkg</span><span class="p">)</span>
<span class="n">w_bkg</span><span class="o">.</span><span class="n">Print</span><span class="p">()</span>
<span class="n">w_bkg</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>
<span class="n">f_out</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
</code></pre></div></p>
<h3 id="datacard">Datacard</h3>
<p>The model workspaces have now been constructed. But before we can run any fits in combine we need to build the so-called <strong>datacard</strong>. This is a text file which defines the different processes entering the fit and their expected yields, and maps these processes to the corresponding (parametric) models. We also store information on the systematic uncertainties in the datacard (see part 3). Given the low complexity of this example, the datacard is reasonably short. The datacard for this section is titled <code>datacard_part1.txt</code>. Take some time to understand the different lines. In particular, the values for the process normalisations:</p>
<p><strong>Tasks and questions:</strong></p>
<ul>
<li>Where does the signal (ggH) normalisation come from?</li>
<li>Why do we use a value of 1.0 for the background model normalisation in this analysis?</li>
</ul>
<p><div class="highlight"><pre><span></span><code><span class="c1"># Datacard example for combine tutorial 2023 (part 1)</span>
---------------------------------------------
imax<span class="w"> </span><span class="m">1</span>
jmax<span class="w"> </span><span class="m">1</span>
kmax<span class="w"> </span>*
---------------------------------------------

shapes<span class="w">      </span>ggH<span class="w">          </span>Tag0<span class="w">      </span>workspace_sig.root<span class="w">      </span>workspace_sig:model_ggH_Tag0
shapes<span class="w">      </span>bkg_mass<span class="w">     </span>Tag0<span class="w">      </span>workspace_bkg.root<span class="w">      </span>workspace_bkg:model_bkg_Tag0
shapes<span class="w">      </span>data_obs<span class="w">     </span>Tag0<span class="w">      </span>workspace_bkg.root<span class="w">      </span>workspace_bkg:data_Tag0

---------------------------------------------
bin<span class="w">             </span>Tag0
observation<span class="w">     </span>-1
---------------------------------------------
bin<span class="w">             </span>Tag0<span class="w">         </span>Tag0
process<span class="w">         </span>ggH<span class="w">          </span>bkg_mass
process<span class="w">         </span><span class="m">0</span><span class="w">            </span><span class="m">1</span>
rate<span class="w">            </span><span class="m">181</span>.01<span class="w">       </span><span class="m">1</span>.0
---------------------------------------------
</code></pre></div>
To compile the datacard we run the following command, using a value of the Higgs mass of 125.0:
<div class="highlight"><pre><span></span><code>text2workspace.py<span class="w"> </span>datacard_part1.txt<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span>
</code></pre></div></p>
<p><strong>Tasks and questions:</strong></p>
<ul>
<li>Run the command above. his compiles the datacard into a RooWorkspace, effectively building the likelihood function. Try opening the compiled workspace (<code>root datacard_part1.root</code>) and print the contents (use <code>w-&gt;Print()</code>).</li>
<li>Do you understand what all the different objects are? What does the variable <code>r</code> correspond to? Try (verbose) printing with <code>w-&gt;var("r")-&gt;Print("v")</code>.</li>
</ul>
<h3 id="extension-signal-normalisation-object">Extension: signal normalisation object</h3>
<p>In the example above, the signal model normalisation is input by hand in the datacard. We can instead define the signal normalisation components in the model in a similar fashion to the background model normalisation object. Let's build the cross section (ggH), branching fraction (H-&gt;gamgam), and efficiency variables. It's important to set these terms to be constant for the final fit to data:
<div class="highlight"><pre><span></span><code><span class="n">xs_ggH</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooRealVar</span><span class="p">(</span><span class="s2">&quot;xs_ggH&quot;</span><span class="p">,</span> <span class="s2">&quot;Cross section of ggH in [pb]&quot;</span><span class="p">,</span> <span class="mf">48.58</span> <span class="p">)</span>
<span class="n">br_gamgam</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooRealVar</span><span class="p">(</span><span class="s2">&quot;BR_gamgam&quot;</span><span class="p">,</span> <span class="s2">&quot;Branching ratio of Higgs to gamma gamma&quot;</span><span class="p">,</span> <span class="mf">0.0027</span> <span class="p">)</span>
<span class="n">eff_ggH_Tag0</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooRealVar</span><span class="p">(</span><span class="s2">&quot;eff_ggH_Tag0&quot;</span><span class="p">,</span> <span class="s2">&quot;Efficiency for ggH events to land in Tag0&quot;</span><span class="p">,</span> <span class="n">eff</span> <span class="p">)</span>

<span class="n">xs_ggH</span><span class="o">.</span><span class="n">setConstant</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">br_gamgam</span><span class="o">.</span><span class="n">setConstant</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">eff_ggH_Tag0</span><span class="o">.</span><span class="n">setConstant</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
The normalisation component is then defined as the product of these three variables:
<div class="highlight"><pre><span></span><code><span class="n">norm_sig</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooProduct</span><span class="p">(</span><span class="s2">&quot;model_ggH_Tag0_norm&quot;</span><span class="p">,</span> <span class="s2">&quot;Normalisation term for ggH in Tag 0&quot;</span><span class="p">,</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooArgList</span><span class="p">(</span><span class="n">xs_ggH</span><span class="p">,</span><span class="n">br_gamgam</span><span class="p">,</span><span class="n">eff_ggH_Tag0</span><span class="p">))</span>
</code></pre></div></p>
<p>Again the syntax <code>{model}_norm</code> has been used so that combine will automatically assign this object as the normalisation for the model (<code>model_ggH_Tag0</code>). Firstly we need to save a new version of the signal model workspace with the normalisation term included.
<div class="highlight"><pre><span></span><code><span class="n">f_out</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TFile</span><span class="p">(</span><span class="s2">&quot;workspace_sig_with_norm.root&quot;</span><span class="p">,</span> <span class="s2">&quot;RECREATE&quot;</span><span class="p">)</span>
<span class="n">w_sig</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooWorkspace</span><span class="p">(</span><span class="s2">&quot;workspace_sig&quot;</span><span class="p">,</span><span class="s2">&quot;workspace_sig&quot;</span><span class="p">)</span>
<span class="nb">getattr</span><span class="p">(</span><span class="n">w_sig</span><span class="p">,</span> <span class="s2">&quot;import&quot;</span><span class="p">)(</span><span class="n">model</span><span class="p">)</span>
<span class="nb">getattr</span><span class="p">(</span><span class="n">w_sig</span><span class="p">,</span> <span class="s2">&quot;import&quot;</span><span class="p">)(</span><span class="n">norm_sig</span><span class="p">)</span>
<span class="n">w_sig</span><span class="o">.</span><span class="n">Print</span><span class="p">()</span>
<span class="n">w_sig</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>
<span class="n">f_out</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
</code></pre></div>
We then need to modify the datacard to account for this normalisation term. Importantly, the <code>{model}_norm</code> term in our updated signal model workspace does not contain the integrated luminosity. Therefore, the <code>rate</code> term in the datacard must be set equal to the integrated luminosity in [pb^-1] (as the cross section was defined in [pb]). The total normalisation for the signal model is then the product of the <code>{model}_norm</code> and the <code>rate</code> value.</p>
<p><strong>Tasks and questions:</strong></p>
<ul>
<li>You can find the example datacard here: <code>datacard_part1_with_norm.txt</code> with the signal normalisation object included. Check if it compiles successfully using <code>text2workspace</code>? If so, try printing out the contents of the workspace. Can you see the normalisation component?</li>
</ul>
<h3 id="extension-unbinned-vs-binned">Extension: unbinned vs binned</h3>
<p>In a parametric analysis, the fit can be performed using a binned or unbinned likelihood function. The consequences of binned vs unbinned likelihoods were discussed in the <a href="https://indico.cern.ch/event/1227742/contributions/5240048/">morning session</a>. In combine, we can simply toggle between binned and unbinned fits by changing how the data set is stored in the workspace. In the example above, the data was saved as a <code>RooDataSet</code>. This means that an unbinned maximum likelihood function would be used.</p>
<p>To switch to a <strong>binned</strong> maximum likelihood fit, we need to store the data set in the workspace as a <code>RooDataHist</code>.</p>
<p><strong>Tasks and questions:</strong></p>
<ul>
<li>First load the data as a <code>RooDataSet</code> as before:</li>
</ul>
<p><div class="highlight"><pre><span></span><code><span class="n">f</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TFile</span><span class="p">(</span><span class="s2">&quot;data_part1.root&quot;</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s2">&quot;data_Tag0&quot;</span><span class="p">)</span>

<span class="c1"># Convert TTree to a RooDataSet</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooDataSet</span><span class="p">(</span><span class="s2">&quot;data_Tag0&quot;</span><span class="p">,</span> <span class="s2">&quot;data_Tag0&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooArgSet</span><span class="p">(</span><span class="n">mass</span><span class="p">,</span> <span class="n">weight</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">)</span>
</code></pre></div>
  -   Now set the number of bins in the observable and convert the data to a <code>RooDataHist</code> (as below). In the example below we will use 320 bins over the full mass range (0.25 GeV per bin). It is important that the binning is sufficiently granular so that we do not lose information in the data by switching to a binned likelihood fit. When fitting a signal peak over a background we want the bin width to be sufficiently smaller than the signal model mass resolution. Try changing the number of bins (reducing them) at what point do you start to see diffeeences in the fit results?</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Set bin number for mass variables</span>
<span class="n">mass</span><span class="o">.</span><span class="n">setBins</span><span class="p">(</span><span class="mi">320</span><span class="p">)</span>
<span class="n">data_hist</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooDataHist</span><span class="p">(</span><span class="s2">&quot;data_hist_Tag0&quot;</span><span class="p">,</span> <span class="s2">&quot;data_hist_Tag0&quot;</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

<span class="c1"># Save the background model with the RooDataHist instead</span>
<span class="n">f_out</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TFile</span><span class="p">(</span><span class="s2">&quot;workspace_bkg_binned.root&quot;</span><span class="p">,</span> <span class="s2">&quot;RECREATE&quot;</span><span class="p">)</span>
<span class="n">w_bkg</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooWorkspace</span><span class="p">(</span><span class="s2">&quot;workspace_bkg&quot;</span><span class="p">,</span><span class="s2">&quot;workspace_bkg&quot;</span><span class="p">)</span>
<span class="nb">getattr</span><span class="p">(</span><span class="n">w_bkg</span><span class="p">,</span> <span class="s2">&quot;import&quot;</span><span class="p">)(</span><span class="n">data_hist</span><span class="p">)</span>
<span class="nb">getattr</span><span class="p">(</span><span class="n">w_bkg</span><span class="p">,</span> <span class="s2">&quot;import&quot;</span><span class="p">)(</span><span class="n">norm</span><span class="p">)</span>
<span class="nb">getattr</span><span class="p">(</span><span class="n">w_bkg</span><span class="p">,</span> <span class="s2">&quot;import&quot;</span><span class="p">)(</span><span class="n">model_bkg</span><span class="p">)</span>
<span class="n">w_bkg</span><span class="o">.</span><span class="n">Print</span><span class="p">()</span>
<span class="n">w_bkg</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>
<span class="n">f_out</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
</code></pre></div>
<h2 id="part-2-simple-fits">Part 2: Simple fits</h2>
<p>Now the parametric models have been constructed and the datacard has been compiled, we are ready to start using combine for running fits. In CMS analyses we begin by blinding ourselves to the data in the signal region, and looking only at the expected results based off toys datasets (asimov or pseudo-experiments). In this exercise, we will look straight away at the observed results. Note, the python commands in this section are taken from the script called <code>simple_fits.py</code>.</p>
<p><strong>Tasks and questions:</strong></p>
<ul>
<li>Run a simple best-fit for the signal strength, <code>r</code>, fixing the Higgs mass to 125 GeV, you can run the command in the terminal:
<div class="highlight"><pre><span></span><code>combine<span class="w"> </span>-M<span class="w"> </span>MultiDimFit<span class="w"> </span>datacard_part1_with_norm.root<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span><span class="w"> </span>--freezeParameters<span class="w"> </span>MH<span class="w"> </span>--saveWorkspace<span class="w"> </span>-n<span class="w"> </span>.bestfit
</code></pre></div>
We obtain a best-fit signal strength of <code>r = 1.548</code> i.e. the observed signal yield is 1.548 times the SM prediction.</li>
</ul>
<p>The option <code>--saveWorkspace</code> stores a snapshot of the postfit workspace in the output file (<code>higgsCombine.bestfit.MultiDimFit.mH125.root</code>). We can load the postfit workspace and look at how the values of all the fit parameters change (compare the <code>clean</code> and <code>MultiDimFit</code> parameter snapshots):
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">ROOT</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TFile</span><span class="p">(</span><span class="s2">&quot;higgsCombine.bestfit.MultiDimFit.mH125.root&quot;</span><span class="p">)</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
<span class="n">w</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">)</span>
</code></pre></div>
We can even plot the postfit signal-plus-background model using the workspace snapshot:
<div class="highlight"><pre><span></span><code><span class="n">n_bins</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">binning</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">Binning</span><span class="p">(</span><span class="n">n_bins</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">180</span><span class="p">)</span>

<span class="n">can</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TCanvas</span><span class="p">()</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="s2">&quot;CMS_hgg_mass&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">frame</span><span class="p">()</span>
<span class="n">w</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s2">&quot;data_obs&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">plotOn</span><span class="p">(</span> <span class="n">plot</span><span class="p">,</span> <span class="n">binning</span> <span class="p">)</span>

<span class="c1"># Load the S+B model</span>
<span class="n">sb_model</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="s2">&quot;model_s&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getPdf</span><span class="p">(</span><span class="s2">&quot;Tag0&quot;</span><span class="p">)</span>

<span class="c1"># Prefit</span>
<span class="n">sb_model</span><span class="o">.</span><span class="n">plotOn</span><span class="p">(</span> <span class="n">plot</span><span class="p">,</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">LineColor</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s2">&quot;prefit&quot;</span><span class="p">)</span> <span class="p">)</span>

<span class="c1"># Postfit</span>
<span class="n">w</span><span class="o">.</span><span class="n">loadSnapshot</span><span class="p">(</span><span class="s2">&quot;MultiDimFit&quot;</span><span class="p">)</span>
<span class="n">sb_model</span><span class="o">.</span><span class="n">plotOn</span><span class="p">(</span> <span class="n">plot</span><span class="p">,</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">LineColor</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s2">&quot;postfit&quot;</span><span class="p">)</span> <span class="p">)</span>
<span class="n">r_bestfit</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getVal</span><span class="p">()</span>

<span class="n">plot</span><span class="o">.</span><span class="n">Draw</span><span class="p">()</span>

<span class="n">leg</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TLegend</span><span class="p">(</span><span class="mf">0.55</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.85</span><span class="p">,</span><span class="mf">0.85</span><span class="p">)</span>
<span class="n">leg</span><span class="o">.</span><span class="n">AddEntry</span><span class="p">(</span><span class="s2">&quot;prefit&quot;</span><span class="p">,</span> <span class="s2">&quot;Prefit S+B model (r=1.00)&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">)</span>
<span class="n">leg</span><span class="o">.</span><span class="n">AddEntry</span><span class="p">(</span><span class="s2">&quot;postfit&quot;</span><span class="p">,</span> <span class="s2">&quot;Postfit S+B model (r=</span><span class="si">%.2f</span><span class="s2">)&quot;</span><span class="o">%</span><span class="n">r_bestfit</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">)</span>
<span class="n">leg</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="s2">&quot;Same&quot;</span><span class="p">)</span>

<span class="n">can</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
<span class="n">can</span><span class="o">.</span><span class="n">SaveAs</span><span class="p">(</span><span class="s2">&quot;part2_sb_model.png&quot;</span><span class="p">)</span>
</code></pre></div></p>
<p><img alt="" src="../plots/part2_sb_model.png" /></p>
<h3 id="confidence-intervals">Confidence intervals</h3>
<p>We not only want to find the best-fit value of the signal strength, r, but also the confidence intervals. The <code>singles</code> algorithm will find the 68% CL intervals:
<div class="highlight"><pre><span></span><code>combine<span class="w"> </span>-M<span class="w"> </span>MultiDimFit<span class="w"> </span>datacard_part1_with_norm.root<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span><span class="w"> </span>--freezeParameters<span class="w"> </span>MH<span class="w"> </span>-n<span class="w"> </span>.singles<span class="w"> </span>--algo<span class="w"> </span>singles
</code></pre></div>
To perform a likelihood scan (i.e. calculate 2NLL at fixed values of the signal strength, profiling the other parameters), we use the <code>grid</code> algorithm. We can control the number of points in the scan using the <code>--points</code> option. Also, it is important to set a suitable range for the signal strength parameter. The <code>singles</code> algorithm has shown us that the 1 stdev interval on r is around +/-0.2.</p>
<p><strong>Tasks and questions:</strong></p>
<ul>
<li>Use these intervals to define a suitable range for the scan, and change <code>lo,hi</code> in the following options accordingly: <code>--setParameterRanges r=lo,hi</code>.</li>
</ul>
<p><div class="highlight"><pre><span></span><code>combine<span class="w"> </span>-M<span class="w"> </span>MultiDimFit<span class="w"> </span>datacard_part1_with_norm.root<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span><span class="w"> </span>--freezeParameters<span class="w"> </span>MH<span class="w"> </span>-n<span class="w"> </span>.scan<span class="w"> </span>--algo<span class="w"> </span>grid<span class="w"> </span>--points<span class="w"> </span><span class="m">20</span><span class="w"> </span>--setParameterRanges<span class="w"> </span><span class="nv">r</span><span class="o">=</span>lo,hi
</code></pre></div>
We can use the <code>plot1DScan.py</code> function from CombineTools to plot the likelihood scan:
<div class="highlight"><pre><span></span><code>plot1DScan.py<span class="w"> </span>higgsCombine.scan.MultiDimFit.mH125.root<span class="w"> </span>-o<span class="w"> </span>part2_scan
</code></pre></div>
<img alt="" src="../plots/part2_scan.png" /></p>
<ul>
<li>Do you understand what the plot is showing? What information about the signal strength parameter can be inferred from the plot?</li>
</ul>
<h3 id="extension-expected-fits">Extension: expected fits</h3>
<p>To run <em>expected</em> fits we simply add <code>-t N</code> to the combine command. For <code>N&gt;0</code>, this will generate N random toys from the model and fit each one independently. For <code>N=-1</code>, this will generate an asimov toy in which all statistical fluctuations from the model are suppressed.</p>
<p>You can use the <code>--expectSignal 1</code> option to set the signal strength parameter to 1 when generating the toy. Alternatively, <code>--expectSignal 0</code> will generate a toy from the background-only model. For multiple parameter models you can set the initial values when generating the toy(s) using the <code>--setParameters</code> option of combine. For example, if you want to throw a toy where the Higgs mass is at 124 GeV and the background slope parameter <code>alpha</code> is equal to -0.05, you would add <code>--setParameters MH=124.0,alpha=-0.05</code>.</p>
<p><strong>Tasks and questions:</strong></p>
<ul>
<li>Try running the asimov likelihood scan for <code>r=1</code> and <code>r=0</code>, and plotting them using the <code>plot1DScan.py</code> script.</li>
</ul>
<h3 id="extension-goodness-of-fit-tests">Extension: goodness-of-fit tests</h3>
<p>The goodness-of-fit tests available in combine are only well-defined for binned maximum likelihood fits. Therefore, to perform a goodness-of-fit test with a parametric datacard, make sure to save the data object as a <code>RooDataHist</code>, as in <code>workspace_bkg_binned.root</code>.</p>
<p><strong>Tasks and questions:</strong></p>
<ul>
<li>Try editing the <code>datacard_part1_with_norm.txt</code> file to pick up the correct binned workspace file, and the <code>RooDataHist</code>. The goodness-of-fit method requires at-least one nuisance parameter in the model to run successfully. Append the following line to the end of the datacard:
<div class="highlight"><pre><span></span><code>lumi_13TeV<span class="w">      </span>lnN<span class="w">          </span><span class="m">1</span>.01<span class="w">         </span>-
</code></pre></div></li>
<li>Does the datacard compile with the <code>text2workspace.py</code> command?</li>
</ul>
<p>We use the <code>GoodnessOfFit</code> method in combine to evaluate how compatible the observed data are with the model pdf. There are three types of GoF algorithm within combine, this example will use the <code>saturated</code> algorithm. You can find more information about the other algorithms <a href="https://cms-analysis.github.io/HiggsAnalysis-CombinedLimit/part3/commonstatsmethods/#goodness-of-fit-tests">here</a>.</p>
<p>Firstly, we want to calculate the value of the test statistic for the observed data:
<div class="highlight"><pre><span></span><code>combine<span class="w"> </span>-M<span class="w"> </span>GoodnessOfFit<span class="w"> </span>datacard_part1_binned.root<span class="w"> </span>--algo<span class="w"> </span>saturated<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span><span class="w"> </span>--freezeParameters<span class="w"> </span>MH<span class="w"> </span>-n<span class="w"> </span>.goodnessOfFit_data
</code></pre></div></p>
<p>Now lets calculate the test statistic value for many toys thrown from the model:
<div class="highlight"><pre><span></span><code>combine<span class="w"> </span>-M<span class="w"> </span>GoodnessOfFit<span class="w"> </span>datacard_part1_binned.root<span class="w"> </span>--algo<span class="w"> </span>saturated<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span><span class="w"> </span>--freezeParameters<span class="w"> </span>MH<span class="w"> </span>-n<span class="w"> </span>.goodnessOfFit_toys<span class="w"> </span>-t<span class="w"> </span><span class="m">1000</span>
</code></pre></div></p>
<p>To make a plot of the GoF test-statistic distribution you can run the following commands, which first collect the values of the test-statistic into a json file, and then plots from the json file:
<div class="highlight"><pre><span></span><code>combineTool.py<span class="w"> </span>-M<span class="w"> </span>CollectGoodnessOfFit<span class="w"> </span>--input<span class="w"> </span>higgsCombine.goodnessOfFit_data.GoodnessOfFit.mH125.root<span class="w"> </span>higgsCombine.goodnessOfFit_toys.GoodnessOfFit.mH125.123456.root<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span>.0<span class="w"> </span>-o<span class="w"> </span>gof.json

plotGof.py<span class="w"> </span>gof.json<span class="w"> </span>--statistic<span class="w"> </span>saturated<span class="w"> </span>--mass<span class="w"> </span><span class="m">125</span>.0<span class="w"> </span>-o<span class="w"> </span>part2_gof
</code></pre></div></p>
<p><img alt="" src="../plots/part2_gof.png" /></p>
<ul>
<li>What does the plot tell us? Does the model fit the data well?</li>
</ul>
<h2 id="part-3-systematic-uncertainties">Part 3: Systematic uncertainties</h2>
<p>In this section, we will learn how to add systematic uncertainties to a parametric fit analysis. The python commands are taken from the <code>systematics.py</code> script.</p>
<p>For uncertainties which only affect the process normalisation, we can simply implement these as <code>lnN</code> uncertainties in the datacard. The file <code>mc_part3.root</code> contains the systematic-varied trees i.e. Monte-Carlo events where some systematic uncertainty source <code>{photonID,JEC,scale,smear}</code> has been varied up and down by <span class="arithmatex">\(1\sigma\)</span>.
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">ROOT</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TFile</span><span class="p">(</span><span class="s2">&quot;mc_part3.root&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">ls</span><span class="p">()</span>
</code></pre></div>
Gives the output:
<div class="highlight"><pre><span></span><code>TFile**<span class="w">     </span>mc_part3.root
<span class="w"> </span>TFile*<span class="w">     </span>mc_part3.root
<span class="w">  </span>KEY:<span class="w"> </span>TTree<span class="w">    </span>ggH_Tag0<span class="p">;</span><span class="m">1</span><span class="w">  </span>ggH_Tag0
<span class="w">  </span>KEY:<span class="w"> </span>TTree<span class="w">    </span>ggH_Tag0_photonIDUp01Sigma<span class="p">;</span><span class="m">1</span><span class="w">    </span>ggH_Tag0_photonIDUp01Sigma
<span class="w">  </span>KEY:<span class="w"> </span>TTree<span class="w">    </span>ggH_Tag0_photonIDDown01Sigma<span class="p">;</span><span class="m">1</span><span class="w">  </span>ggH_Tag0_photonIDDown01Sigma
<span class="w">  </span>KEY:<span class="w"> </span>TTree<span class="w">    </span>ggH_Tag0_scaleUp01Sigma<span class="p">;</span><span class="m">1</span><span class="w">   </span>ggH_Tag0_scaleUp01Sigma
<span class="w">  </span>KEY:<span class="w"> </span>TTree<span class="w">    </span>ggH_Tag0_scaleDown01Sigma<span class="p">;</span><span class="m">1</span><span class="w"> </span>ggH_Tag0_scaleDown01Sigma
<span class="w">  </span>KEY:<span class="w"> </span>TTree<span class="w">    </span>ggH_Tag0_smearUp01Sigma<span class="p">;</span><span class="m">1</span><span class="w">   </span>ggH_Tag0_smearUp01Sigma
<span class="w">  </span>KEY:<span class="w"> </span>TTree<span class="w">    </span>ggH_Tag0_smearDown01Sigma<span class="p">;</span><span class="m">1</span><span class="w"> </span>ggH_Tag0_smearDown01Sigma
<span class="w">  </span>KEY:<span class="w"> </span>TTree<span class="w">    </span>ggH_Tag0_JECUp01Sigma<span class="p">;</span><span class="m">1</span><span class="w"> </span>ggH_Tag0_JECUp01Sigma
<span class="w">  </span>KEY:<span class="w"> </span>TTree<span class="w">    </span>ggH_Tag0_JECDown01Sigma<span class="p">;</span><span class="m">1</span><span class="w">   </span>ggH_Tag0_JECDown01Sigma
</code></pre></div>
Let's first load the systematic-varied trees as RooDataSets and store them in a python dictionary, <code>mc</code>:</p>
<p><strong>Tasks and questions:</strong></p>
<ul>
<li>Run the code below (or uncomment the relevant section of the script for this part).</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># Define mass and weight variables</span>
<span class="n">mass</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooRealVar</span><span class="p">(</span><span class="s2">&quot;CMS_hgg_mass&quot;</span><span class="p">,</span> <span class="s2">&quot;CMS_hgg_mass&quot;</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span>
<span class="n">weight</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooRealVar</span><span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="n">mc</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># Load the nominal dataset</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s2">&quot;ggH_Tag0&quot;</span><span class="p">)</span>
<span class="n">mc</span><span class="p">[</span><span class="s1">&#39;nominal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooDataSet</span><span class="p">(</span><span class="s2">&quot;ggH_Tag0&quot;</span><span class="p">,</span><span class="s2">&quot;ggH_Tag0&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooArgSet</span><span class="p">(</span><span class="n">mass</span><span class="p">,</span><span class="n">weight</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span> <span class="p">)</span>

<span class="c1"># Load the systematic-varied datasets</span>
<span class="k">for</span> <span class="n">syst</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;JEC&#39;</span><span class="p">,</span><span class="s1">&#39;photonID&#39;</span><span class="p">,</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span><span class="s1">&#39;smear&#39;</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">direction</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Up&#39;</span><span class="p">,</span><span class="s1">&#39;Down&#39;</span><span class="p">]:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">01Sigma&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">syst</span><span class="p">,</span><span class="n">direction</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ggH_Tag0_</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">mc</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooDataSet</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooArgSet</span><span class="p">(</span><span class="n">mass</span><span class="p">,</span><span class="n">weight</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span> <span class="p">)</span>
</code></pre></div>
<p>The jet energy scale (JEC) and photon identification (photonID) uncertainties do not affect the shape of the <span class="arithmatex">\(m_{\gamma\gamma}\)</span> distribution i.e. they only effect the signal yield estimate. We can calculate their impact by comparing the sum of weights to the nominal dataset. Note, the photonID uncertainty changes the weight of the events in the tree, whereas the JEC varied trees contain a different set of events, generated by shifting the jet energy scale in the simulation. In any case, the means for calculating the yield variations is equivalent:
<div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="n">syst</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;JEC&#39;</span><span class="p">,</span><span class="s1">&#39;photonID&#39;</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">direction</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Up&#39;</span><span class="p">,</span><span class="s1">&#39;Down&#39;</span><span class="p">]:</span>
        <span class="n">yield_variation</span> <span class="o">=</span> <span class="n">mc</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">01Sigma&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">syst</span><span class="p">,</span><span class="n">direction</span><span class="p">)]</span><span class="o">.</span><span class="n">sumEntries</span><span class="p">()</span><span class="o">/</span><span class="n">mc</span><span class="p">[</span><span class="s1">&#39;nominal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sumEntries</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Systematic varied yield (</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">): </span><span class="si">%.3f</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">syst</span><span class="p">,</span><span class="n">direction</span><span class="p">,</span><span class="n">yield_variation</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Systematic<span class="w"> </span>varied<span class="w"> </span>yield<span class="w"> </span><span class="o">(</span>JEC,Up<span class="o">)</span>:<span class="w"> </span><span class="m">1</span>.056
Systematic<span class="w"> </span>varied<span class="w"> </span>yield<span class="w"> </span><span class="o">(</span>JEC,Down<span class="o">)</span>:<span class="w"> </span><span class="m">0</span>.951
Systematic<span class="w"> </span>varied<span class="w"> </span>yield<span class="w"> </span><span class="o">(</span>photonID,Up<span class="o">)</span>:<span class="w"> </span><span class="m">1</span>.050
Systematic<span class="w"> </span>varied<span class="w"> </span>yield<span class="w"> </span><span class="o">(</span>photonID,Down<span class="o">)</span>:<span class="w"> </span><span class="m">0</span>.950
</code></pre></div>
We can write these yield variations in the datacard with the lines:
<div class="highlight"><pre><span></span><code>CMS_scale_j<span class="w">           </span>lnN<span class="w">      </span><span class="m">0</span>.951/1.056<span class="w">      </span>-
CMS_hgg_phoIdMva<span class="w">      </span>lnN<span class="w">      </span><span class="m">1</span>.05<span class="w">             </span>-
</code></pre></div></p>
<p><strong>Tasks and questions:</strong></p>
<ul>
<li>Run the code (or uncomment the relevant lines of code in the script) to produce the systematic variations in the workspace and add the datacard lines above to the datacard.</li>
<li>Why is the photonID uncertainty expressed as one number, whereas the JEC uncertainty is defined by two?</li>
</ul>
<p>Note in this analysis there are no systematic uncertainties affecting the background estimate (<code>-</code> in the datacard), as the background model has been derived directly from data.</p>
<h3 id="parametric-shape-uncertainties">Parametric shape uncertainties</h3>
<p>What about systematic uncertainties which affect the shape of the mass distribution?</p>
<p>In a parametric analysis, we need to build the dependence directly into the model parameters. The example uncertainty sources in this tutorial are the photon energy scale and smearing uncertainties. From the names alone we can expect that the <strong>scale</strong> uncertainty will affect the mean of the signal Gaussian, and the <strong>smear</strong> uncertainty will impact the resolution (sigma). Let's first take a look at the <code>scaleUp01Sigma</code> dataset:</p>
<p><div class="highlight"><pre><span></span><code><span class="c1"># Build the model to fit the systematic-varied datasets</span>
<span class="n">mean</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooRealVar</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">126</span><span class="p">)</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooRealVar</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
<span class="n">gaus</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooGaussian</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>

<span class="c1"># Run the fits twice (second time from the best-fit of first run) to obtain more reliable results</span>
<span class="n">gaus</span><span class="o">.</span><span class="n">fitTo</span><span class="p">(</span><span class="n">mc</span><span class="p">[</span><span class="s1">&#39;scaleUp01Sigma&#39;</span><span class="p">],</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">SumW2Error</span><span class="p">(</span><span class="kc">True</span><span class="p">),</span><span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">PrintLevel</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="n">gaus</span><span class="o">.</span><span class="n">fitTo</span><span class="p">(</span><span class="n">mc</span><span class="p">[</span><span class="s1">&#39;scaleUp01Sigma&#39;</span><span class="p">],</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">SumW2Error</span><span class="p">(</span><span class="kc">True</span><span class="p">),</span><span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">PrintLevel</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean = </span><span class="si">%.3f</span><span class="s2"> +- </span><span class="si">%.3f</span><span class="s2"> GeV, Sigma = </span><span class="si">%.3f</span><span class="s2"> +- </span><span class="si">%.3f</span><span class="s2"> GeV&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">mean</span><span class="o">.</span><span class="n">getVal</span><span class="p">(),</span><span class="n">mean</span><span class="o">.</span><span class="n">getError</span><span class="p">(),</span><span class="n">sigma</span><span class="o">.</span><span class="n">getVal</span><span class="p">(),</span><span class="n">sigma</span><span class="o">.</span><span class="n">getError</span><span class="p">())</span> <span class="p">)</span>
</code></pre></div>
Gives the output:
<div class="highlight"><pre><span></span><code><span class="nv">Mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">125</span>.370<span class="w"> </span>+-<span class="w"> </span><span class="m">0</span>.009<span class="w"> </span>GeV,<span class="w"> </span><span class="nv">Sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span>.011<span class="w"> </span>+-<span class="w"> </span><span class="m">0</span>.006<span class="w"> </span>GeV
</code></pre></div>
Now let's compare the values to the nominal fit for all systematic-varied trees. We observe a significant variation in the mean for the <strong>scale</strong> uncertainty, and a significant variation in sigma for the <strong>smear</strong> uncertainty.
<div class="highlight"><pre><span></span><code><span class="c1"># First fit the nominal dataset</span>
<span class="n">gaus</span><span class="o">.</span><span class="n">fitTo</span><span class="p">(</span><span class="n">mc</span><span class="p">[</span><span class="s1">&#39;nominal&#39;</span><span class="p">],</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">SumW2Error</span><span class="p">(</span><span class="kc">True</span><span class="p">),</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">PrintLevel</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
<span class="n">gaus</span><span class="o">.</span><span class="n">fitTo</span><span class="p">(</span><span class="n">mc</span><span class="p">[</span><span class="s1">&#39;nominal&#39;</span><span class="p">],</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">SumW2Error</span><span class="p">(</span><span class="kc">True</span><span class="p">),</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">PrintLevel</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
<span class="c1"># Save the mean and sigma values and errors to python dicts</span>
<span class="n">mean_values</span><span class="p">,</span> <span class="n">sigma_values</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
<span class="n">mean_values</span><span class="p">[</span><span class="s1">&#39;nominal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mean</span><span class="o">.</span><span class="n">getVal</span><span class="p">(),</span><span class="n">mean</span><span class="o">.</span><span class="n">getError</span><span class="p">()]</span>
<span class="n">sigma_values</span><span class="p">[</span><span class="s1">&#39;nominal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">sigma</span><span class="o">.</span><span class="n">getVal</span><span class="p">(),</span><span class="n">sigma</span><span class="o">.</span><span class="n">getError</span><span class="p">()]</span>

<span class="c1"># Next for the systematic varied datasets</span>
<span class="k">for</span> <span class="n">syst</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span><span class="s1">&#39;smear&#39;</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">direction</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Up&#39;</span><span class="p">,</span><span class="s1">&#39;Down&#39;</span><span class="p">]:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">01Sigma&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">syst</span><span class="p">,</span><span class="n">direction</span><span class="p">)</span>
        <span class="n">gaus</span><span class="o">.</span><span class="n">fitTo</span><span class="p">(</span><span class="n">mc</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="p">,</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">SumW2Error</span><span class="p">(</span><span class="kc">True</span><span class="p">),</span>  <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">PrintLevel</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">gaus</span><span class="o">.</span><span class="n">fitTo</span><span class="p">(</span><span class="n">mc</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">SumW2Error</span><span class="p">(</span><span class="kc">True</span><span class="p">),</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">PrintLevel</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">mean_values</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mean</span><span class="o">.</span><span class="n">getVal</span><span class="p">(),</span> <span class="n">mean</span><span class="o">.</span><span class="n">getError</span><span class="p">()]</span>
        <span class="n">sigma_values</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">sigma</span><span class="o">.</span><span class="n">getVal</span><span class="p">(),</span> <span class="n">sigma</span><span class="o">.</span><span class="n">getError</span><span class="p">()]</span>

<span class="c1"># Print the variations in mean and sigma</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">mean_values</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: mean = </span><span class="si">%.3f</span><span class="s2"> +- </span><span class="si">%.3f</span><span class="s2"> GeV, sigma = </span><span class="si">%.3f</span><span class="s2"> +- </span><span class="si">%.3f</span><span class="s2"> GeV&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">mean_values</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">mean_values</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">sigma_values</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">sigma_values</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
</code></pre></div>
Prints the output:
<div class="highlight"><pre><span></span><code>nominal:<span class="w"> </span><span class="nv">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">125</span>.001<span class="w"> </span>+-<span class="w"> </span><span class="m">0</span>.009<span class="w"> </span>GeV,<span class="w"> </span><span class="nv">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>.996<span class="w"> </span>+-<span class="w"> </span><span class="m">0</span>.006<span class="w"> </span>GeV
scaleUp01Sigma:<span class="w"> </span><span class="nv">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">125</span>.370<span class="w"> </span>+-<span class="w"> </span><span class="m">0</span>.009<span class="w"> </span>GeV,<span class="w"> </span><span class="nv">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span>.011<span class="w"> </span>+-<span class="w"> </span><span class="m">0</span>.006<span class="w"> </span>GeV
scaleDown01Sigma:<span class="w"> </span><span class="nv">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">124</span>.609<span class="w"> </span>+-<span class="w"> </span><span class="m">0</span>.009<span class="w"> </span>GeV,<span class="w"> </span><span class="nv">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span>.005<span class="w"> </span>+-<span class="w"> </span><span class="m">0</span>.006<span class="w"> </span>GeV
smearUp01Sigma:<span class="w"> </span><span class="nv">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">125</span>.005<span class="w"> </span>+-<span class="w"> </span><span class="m">0</span>.009<span class="w"> </span>GeV,<span class="w"> </span><span class="nv">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span>.097<span class="w"> </span>+-<span class="w"> </span><span class="m">0</span>.007<span class="w"> </span>GeV
smearDown01Sigma:<span class="w"> </span><span class="nv">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">125</span>.007<span class="w"> </span>+-<span class="w"> </span><span class="m">0</span>.009<span class="w"> </span>GeV,<span class="w"> </span><span class="nv">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>.912<span class="w"> </span>+-<span class="w"> </span><span class="m">0</span>.006<span class="w"> </span>GeV
</code></pre></div>
The values tell us that the scale uncertainty (at <span class="arithmatex">\(\pm 1 \sigma\)</span>) varies the signal peak mean by around 0.3%, and the smear uncertainty (at <span class="arithmatex">\(\pm 1 \sigma\)</span>) varies the signal width (sigma) by around 4.5% (average of up and down variations).</p>
<p>Now we need to bake these effects into the parametric signal model. The mean of the Gaussian was previously defined as:</p>
<div class="arithmatex">\[ \mu = m_H + \delta\]</div>
<p>We introduce the nuisance parameter <code>nuisance_scale</code> = <span class="arithmatex">\(\eta\)</span> to account for a shift in the signal peak mean using:</p>
<div class="arithmatex">\[ \mu = (m_H + \delta) \cdot (1+0.003\eta)\]</div>
<p>At <span class="arithmatex">\(\eta = +1 (-1)\)</span> the signal peak mean will shift up (down) by 0.3%. To build this into the RooFit signal model we simply define a new parameter, <span class="arithmatex">\(\eta\)</span>, and update the definition of the mean formula variable:
<div class="highlight"><pre><span></span><code><span class="c1"># Building the workspace with systematic variations</span>
<span class="n">MH</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooRealVar</span><span class="p">(</span><span class="s2">&quot;MH&quot;</span><span class="p">,</span> <span class="s2">&quot;MH&quot;</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">130</span> <span class="p">)</span>
<span class="n">MH</span><span class="o">.</span><span class="n">setConstant</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Define formula for mean of Gaussian</span>
<span class="n">dMH</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooRealVar</span><span class="p">(</span><span class="s2">&quot;dMH_ggH_Tag0&quot;</span><span class="p">,</span> <span class="s2">&quot;dMH_ggH_Tag0&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span> <span class="p">)</span>
<span class="n">eta</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooRealVar</span><span class="p">(</span><span class="s2">&quot;nuisance_scale&quot;</span><span class="p">,</span> <span class="s2">&quot;nuisance_scale&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">eta</span><span class="o">.</span><span class="n">setConstant</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">mean_formula</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFormulaVar</span><span class="p">(</span><span class="s2">&quot;mean_ggH_Tag0&quot;</span><span class="p">,</span> <span class="s2">&quot;mean_ggH_Tag0&quot;</span><span class="p">,</span> <span class="s2">&quot;(@0+@1)*(1+0.003*@2)&quot;</span><span class="p">,</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooArgList</span><span class="p">(</span><span class="n">MH</span><span class="p">,</span><span class="n">dMH</span><span class="p">,</span><span class="n">eta</span><span class="p">))</span>
</code></pre></div></p>
<p><strong>Tasks and questions:</strong></p>
<ul>
<li>Update the workspace with the new mean formula variable (using the code above, or uncomment in the script)</li>
<li>Why do we set the nuisance parameter to constant at this stage?</li>
</ul>
<p>Similarly for the width introducing a nuisance parameter, <span class="arithmatex">\(\chi\)</span>:</p>
<div class="arithmatex">\[ \sigma = \sigma \cdot (1+0.045\chi)\]</div>
<p><div class="highlight"><pre><span></span><code><span class="n">sigma</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooRealVar</span><span class="p">(</span><span class="s2">&quot;sigma_ggH_Tag0_nominal&quot;</span><span class="p">,</span> <span class="s2">&quot;sigma_ggH_Tag0_nominal&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">chi</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooRealVar</span><span class="p">(</span><span class="s2">&quot;nuisance_smear&quot;</span><span class="p">,</span> <span class="s2">&quot;nuisance_smear&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">chi</span><span class="o">.</span><span class="n">setConstant</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sigma_formula</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFormulaVar</span><span class="p">(</span><span class="s2">&quot;sigma_ggH_Tag0&quot;</span><span class="p">,</span> <span class="s2">&quot;sigma_ggH_Tag0&quot;</span><span class="p">,</span> <span class="s2">&quot;@0*(1+0.045*@1)&quot;</span><span class="p">,</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooArgList</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span><span class="n">chi</span><span class="p">))</span>
</code></pre></div>
Let's now fit the new model to the signal Monte-Carlo dataset, build the normalisation object and save the workspace.
<div class="highlight"><pre><span></span><code><span class="c1"># Define Gaussian</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooGaussian</span><span class="p">(</span> <span class="s2">&quot;model_ggH_Tag0&quot;</span><span class="p">,</span> <span class="s2">&quot;model_ggH_Tag0&quot;</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">mean_formula</span><span class="p">,</span> <span class="n">sigma_formula</span> <span class="p">)</span>

<span class="c1"># Fit model to MC</span>
<span class="n">model</span><span class="o">.</span><span class="n">fitTo</span><span class="p">(</span> <span class="n">mc</span><span class="p">[</span><span class="s1">&#39;nominal&#39;</span><span class="p">],</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">SumW2Error</span><span class="p">(</span><span class="kc">True</span><span class="p">),</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooFit</span><span class="o">.</span><span class="n">PrintLevel</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>

<span class="c1"># Build signal model normalisation object</span>
<span class="n">xs_ggH</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooRealVar</span><span class="p">(</span><span class="s2">&quot;xs_ggH&quot;</span><span class="p">,</span> <span class="s2">&quot;Cross section of ggH in [pb]&quot;</span><span class="p">,</span> <span class="mf">48.58</span> <span class="p">)</span>
<span class="n">br_gamgam</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooRealVar</span><span class="p">(</span><span class="s2">&quot;BR_gamgam&quot;</span><span class="p">,</span> <span class="s2">&quot;Branching ratio of Higgs to gamma gamma&quot;</span><span class="p">,</span> <span class="mf">0.0027</span> <span class="p">)</span>
<span class="n">eff</span> <span class="o">=</span> <span class="n">mc</span><span class="p">[</span><span class="s1">&#39;nominal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sumEntries</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">xs_ggH</span><span class="o">.</span><span class="n">getVal</span><span class="p">()</span><span class="o">*</span><span class="n">br_gamgam</span><span class="o">.</span><span class="n">getVal</span><span class="p">())</span>
<span class="n">eff_ggH_Tag0</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooRealVar</span><span class="p">(</span><span class="s2">&quot;eff_ggH_Tag0&quot;</span><span class="p">,</span> <span class="s2">&quot;Efficiency for ggH events to land in Tag0&quot;</span><span class="p">,</span> <span class="n">eff</span> <span class="p">)</span>
<span class="c1"># Set values to be constant</span>
<span class="n">xs_ggH</span><span class="o">.</span><span class="n">setConstant</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">br_gamgam</span><span class="o">.</span><span class="n">setConstant</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">eff_ggH_Tag0</span><span class="o">.</span><span class="n">setConstant</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Define normalisation component as product of these three variables</span>
<span class="n">norm_sig</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooProduct</span><span class="p">(</span><span class="s2">&quot;model_ggH_Tag0_norm&quot;</span><span class="p">,</span> <span class="s2">&quot;Normalisation term for ggH in Tag 0&quot;</span><span class="p">,</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooArgList</span><span class="p">(</span><span class="n">xs_ggH</span><span class="p">,</span><span class="n">br_gamgam</span><span class="p">,</span><span class="n">eff_ggH_Tag0</span><span class="p">))</span>

<span class="c1"># Set shape parameters of model to be constant (i.e. fixed in fit to data)</span>
<span class="n">dMH</span><span class="o">.</span><span class="n">setConstant</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sigma</span><span class="o">.</span><span class="n">setConstant</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Build new signal model workspace with signal normalisation term.</span>
<span class="n">f_out</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TFile</span><span class="p">(</span><span class="s2">&quot;workspace_sig_with_syst.root&quot;</span><span class="p">,</span> <span class="s2">&quot;RECREATE&quot;</span><span class="p">)</span>
<span class="n">w_sig</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">RooWorkspace</span><span class="p">(</span><span class="s2">&quot;workspace_sig&quot;</span><span class="p">,</span><span class="s2">&quot;workspace_sig&quot;</span><span class="p">)</span>
<span class="nb">getattr</span><span class="p">(</span><span class="n">w_sig</span><span class="p">,</span> <span class="s2">&quot;import&quot;</span><span class="p">)(</span><span class="n">model</span><span class="p">)</span>
<span class="nb">getattr</span><span class="p">(</span><span class="n">w_sig</span><span class="p">,</span> <span class="s2">&quot;import&quot;</span><span class="p">)(</span><span class="n">norm_sig</span><span class="p">)</span>
<span class="n">w_sig</span><span class="o">.</span><span class="n">Print</span><span class="p">()</span>
<span class="n">w_sig</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>
<span class="n">f_out</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
</code></pre></div>
The final step is to add the parametric uncertainties as Gaussian-constrained nuisance parameters into the datacard. The syntax means the Gaussian constraint term in the likelihood function will have a mean of 0 and a width of 1.
<div class="highlight"><pre><span></span><code>nuisance_scale<span class="w">        </span>param<span class="w">    </span><span class="m">0</span>.0<span class="w">    </span><span class="m">1</span>.0
nuisance_smear<span class="w">        </span>param<span class="w">    </span><span class="m">0</span>.0<span class="w">    </span><span class="m">1</span>.0
</code></pre></div></p>
<p><strong>Tasks and questions:</strong></p>
<ul>
<li>Run the python code above to include the smearing uncertainty too.</li>
<li>Try adding these lines to <code>datacard_part1_with_norm.txt</code>, along with the lines for the JEC and photonID yield uncertainties above, and compiling with the <code>text2workspace</code> command. Open the workspace and look at its contents. You will need to change the signal process workspace file name in the datacard to point to the new workspace (<code>workspace_sig_with_syst.root</code>).</li>
<li>Can you see the new objects in the compiled datacard that have been created for the systematic uncertainties? What do they correspond to?</li>
</ul>
<p>We can now run a fit with the systematic uncertainties included. The option <code>--saveSpecifiedNuis</code> can be called to save the postfit nuisance parameter values in the combine output limit tree.
<div class="highlight"><pre><span></span><code>combine<span class="w"> </span>-M<span class="w"> </span>MultiDimFit<span class="w"> </span>datacard_part1_with_norm.root<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span><span class="w"> </span>--freezeParameters<span class="w"> </span>MH<span class="w"> </span>--saveWorkspace<span class="w"> </span>-n<span class="w"> </span>.bestfit.with_syst<span class="w"> </span>--saveSpecifiedNuis<span class="w"> </span>CMS_scale_j,CMS_hgg_phoIdMva,nuisance_scale,nuisance_smear
</code></pre></div></p>
<p><strong>Tasks and questions:</strong></p>
<ul>
<li>What do the postfit values of the nuisances tell us here? You can check them by opening the output file (<code>root higgsCombine.bestfit.with_syst.MultiDimFit.mH125.root</code>) and running <code>limit-&gt;Show(0)</code>.</li>
<li>Try plotting the postfit mass distribution (as detailed in part 2). Do you notice any difference?</li>
</ul>
<h3 id="uncertainty-breakdown">Uncertainty breakdown</h3>
<p>A more complete datacard with additional nuisance parameters is stored in <code>datacard_part3.txt</code>. We will use this datacard for the rest of part 3. Open the text file and have a look at the contents.</p>
<p>The following line has been appended to the end of the datacard to define the set of theory nuisance parameters. This will come in handy when calculating the uncertainty breakdown.
<div class="highlight"><pre><span></span><code>theory<span class="w"> </span><span class="nv">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>BR_hgg<span class="w"> </span>QCDscale_ggH<span class="w"> </span>pdf_Higgs_ggH<span class="w"> </span>alphaS_ggH<span class="w"> </span>UnderlyingEvent<span class="w"> </span>PartonShower
</code></pre></div></p>
<p><strong>Tasks and questions:</strong></p>
<ul>
<li>
<p>Compile the datacard and run an observed <code>MultiDimFit</code> likelihood scan over the signal strength, r:
<div class="highlight"><pre><span></span><code>text2workspace.py<span class="w"> </span>datacard_part3.txt<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span>

combine<span class="w"> </span>-M<span class="w"> </span>MultiDimFit<span class="w"> </span>datacard_part3.root<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span><span class="w"> </span>--freezeParameters<span class="w"> </span>MH<span class="w"> </span>-n<span class="w"> </span>.scan.with_syst<span class="w"> </span>--algo<span class="w"> </span>grid<span class="w"> </span>--points<span class="w"> </span><span class="m">20</span><span class="w"> </span>--setParameterRanges<span class="w"> </span><span class="nv">r</span><span class="o">=</span><span class="m">0</span>.5,2.5
</code></pre></div></p>
</li>
<li>
<p>Our aim is to break down the total uncertainty into the systematic and statistical components. To get the statistical-uncertainty-only scan it should be as simple as freezing the nuisance parameters in the fit... right? Try it by adding <code>,allConstrainedNuisances</code> to the <code>--freezeParameters</code> option. This will freeze all (constrained) nuisance parameters in the fit. You can also feed in regular expressions with wildcards using <code>rgx{.*}</code>. For instance to freeze only the <code>nuisance_scale</code> and <code>nuisance_smear</code> you could run with <code>--freezeParameters MH,rgx{nuisance_.*}</code>.</p>
</li>
</ul>
<p><div class="highlight"><pre><span></span><code>combine<span class="w"> </span>-M<span class="w"> </span>MultiDimFit<span class="w"> </span>datacard_part3.root<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span><span class="w"> </span>--freezeParameters<span class="w"> </span>MH,allConstrainedNuisances<span class="w"> </span>-n<span class="w"> </span>.scan.with_syst.statonly<span class="w"> </span>--algo<span class="w"> </span>grid<span class="w"> </span>--points<span class="w"> </span><span class="m">20</span><span class="w"> </span>--setParameterRanges<span class="w"> </span><span class="nv">r</span><span class="o">=</span><span class="m">0</span>.5,2.5
</code></pre></div>
  -   Plot the two likelihood scans on the same axis. You can use the plotting script provided or write your own.
<div class="highlight"><pre><span></span><code>plot1DScan.py<span class="w"> </span>higgsCombine.scan.with_syst.MultiDimFit.mH125.root<span class="w"> </span>--main-label<span class="w"> </span><span class="s2">&quot;With systematics&quot;</span><span class="w"> </span>--main-color<span class="w"> </span><span class="m">1</span><span class="w"> </span>--others<span class="w"> </span>higgsCombine.scan.with_syst.statonly.MultiDimFit.mH125.root:<span class="s2">&quot;Stat-only&quot;</span>:2<span class="w"> </span>-o<span class="w"> </span>part3_scan_v0
</code></pre></div></p>
<p><img alt="" src="../plots/part3_scan_v0.png" /></p>
<ul>
<li>Can you spot the problem?</li>
</ul>
<p>The nuisance parameters introduced into the model have pulled the best-fit signal strength point! Therefore we cannot simply subtract the uncertainties in quadrature to get an estimate for the systematic/statistical uncertainty breakdown.</p>
<p>The correct approach is to freeze the nuisance parameters to their respective best-fit values in the stat-only scan.</p>
<ul>
<li>We can do this by first saving a postfit workspace with all nuisance parameters profiled in the fit. Then we load the postfit snapshot values of the nuisance parameters (with the option <code>--snapshotName MultiDimFit</code>) from the combine output of the previous step, and then freeze the nuisance parameters for the stat-only scan.
<div class="highlight"><pre><span></span><code>combine<span class="w"> </span>-M<span class="w"> </span>MultiDimFit<span class="w"> </span>datacard_part3.root<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span><span class="w"> </span>--freezeParameters<span class="w"> </span>MH<span class="w"> </span>-n<span class="w"> </span>.bestfit.with_syst<span class="w"> </span>--setParameterRanges<span class="w"> </span><span class="nv">r</span><span class="o">=</span><span class="m">0</span>.5,2.5<span class="w"> </span>--saveWorkspace

combine<span class="w"> </span>-M<span class="w"> </span>MultiDimFit<span class="w"> </span>higgsCombine.bestfit.with_syst.MultiDimFit.mH125.root<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span><span class="w"> </span>--freezeParameters<span class="w"> </span>MH,allConstrainedNuisances<span class="w"> </span>-n<span class="w"> </span>.scan.with_syst.statonly_correct<span class="w"> </span>--algo<span class="w"> </span>grid<span class="w"> </span>--points<span class="w"> </span><span class="m">20</span><span class="w"> </span>--setParameterRanges<span class="w"> </span><span class="nv">r</span><span class="o">=</span><span class="m">0</span>.5,2.5<span class="w"> </span>--snapshotName<span class="w"> </span>MultiDimFit
</code></pre></div></li>
<li>Adding the option <code>--breakdown syst,stat</code> to the <code>plot1DScan.py</code> command will automatically calculate the uncertainty breakdown for you.
<div class="highlight"><pre><span></span><code>plot1DScan.py<span class="w"> </span>higgsCombine.scan.with_syst.MultiDimFit.mH125.root<span class="w"> </span>--main-label<span class="w"> </span><span class="s2">&quot;With systematics&quot;</span><span class="w"> </span>--main-color<span class="w"> </span><span class="m">1</span><span class="w"> </span>--others<span class="w"> </span>higgsCombine.scan.with_syst.statonly_correct.MultiDimFit.mH125.root:<span class="s2">&quot;Stat-only&quot;</span>:2<span class="w"> </span>-o<span class="w"> </span>part3_scan_v1<span class="w"> </span>--breakdown<span class="w"> </span>syst,stat
</code></pre></div></li>
</ul>
<p><img alt="" src="../plots/part3_scan_v1.png" /></p>
<p>We can also freeze groups of nuisance parameters defined in the datacard with the option <code>--freezeNuisanceGroups</code>. Let's run a scan freezing only the theory uncertainties (using the nuisance group we defined in the datacard):
<div class="highlight"><pre><span></span><code>combine<span class="w"> </span>-M<span class="w"> </span>MultiDimFit<span class="w"> </span>higgsCombine.bestfit.with_syst.MultiDimFit.mH125.root<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span><span class="w"> </span>--freezeParameters<span class="w"> </span>MH<span class="w"> </span>--freezeNuisanceGroups<span class="w"> </span>theory<span class="w"> </span>-n<span class="w"> </span>.scan.with_syst.freezeTheory<span class="w"> </span>--algo<span class="w"> </span>grid<span class="w"> </span>--points<span class="w"> </span><span class="m">20</span><span class="w"> </span>--setParameterRanges<span class="w"> </span><span class="nv">r</span><span class="o">=</span><span class="m">0</span>.5,2.5<span class="w"> </span>--snapshotName<span class="w"> </span>MultiDimFit
</code></pre></div>
To breakdown the total uncertainty into the theory, experimental and statistical components we can then use:
<div class="highlight"><pre><span></span><code>plot1DScan.py<span class="w"> </span>higgsCombine.scan.with_syst.MultiDimFit.mH125.root<span class="w"> </span>--main-label<span class="w"> </span>Total<span class="w"> </span>--main-color<span class="w"> </span><span class="m">1</span><span class="w"> </span>--others<span class="w"> </span>higgsCombine.scan.with_syst.freezeTheory.MultiDimFit.mH125.root:<span class="s2">&quot;Freeze theory&quot;</span>:4<span class="w"> </span>higgsCombine.scan.with_syst.statonly_correct.MultiDimFit.mH125.root:<span class="s2">&quot;Stat-only&quot;</span>:2<span class="w"> </span>-o<span class="w"> </span>part3_scan_v2<span class="w"> </span>--breakdown<span class="w"> </span>theory,exp,stat
</code></pre></div></p>
<p><img alt="" src="../plots/part3_scan_v2.png" /></p>
<p>These methods are not limited to this particular grouping of systematics. We can use the above procedure to assess the impact of any nuisance parameter(s) on the signal strength confidence interval.</p>
<p><strong>Tasks and questions:</strong></p>
<ul>
<li>Try and calculate the contribution to the total uncertainty from the luminosity estimate using this approach.</li>
</ul>
<h3 id="impacts">Impacts</h3>
<p>It is often useful/required to check the impacts of the nuisance parameters (NP) on the parameter of interest, r. The impact of a NP is defined as the shift <span class="arithmatex">\(\Delta r\)</span> induced as the NP, <span class="arithmatex">\(\theta\)</span>, is fixed to its <span class="arithmatex">\(\pm1\sigma\)</span> values, with all other parameters profiled as normal. More information can be found in the combine documentation via this <a href="https://cms-analysis.github.io/HiggsAnalysis-CombinedLimit/part3/nonstandard/#nuisance-parameter-impacts">link</a>.</p>
<p>Let's calculate the impacts for our analysis. We can use the <code>combineTool.py</code> to automate the scripts. The impacts are calculated in a few stages:</p>
<p>1) Do an initial fit for the parameter of interest, adding the <code>--robustFit 1</code> option:
<div class="highlight"><pre><span></span><code>combineTool.py<span class="w"> </span>-M<span class="w"> </span>Impacts<span class="w"> </span>-d<span class="w"> </span>datacard_part3.root<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span><span class="w"> </span>--freezeParameters<span class="w"> </span>MH<span class="w"> </span>-n<span class="w"> </span>.impacts<span class="w"> </span>--setParameterRanges<span class="w"> </span><span class="nv">r</span><span class="o">=</span><span class="m">0</span>.5,2.5<span class="w"> </span>--doInitialFit<span class="w"> </span>--robustFit<span class="w"> </span><span class="m">1</span>
</code></pre></div></p>
<p>2) Next perform a similar scan for each NP with the <code>--doFits</code> option. This may take a few minutes:
<div class="highlight"><pre><span></span><code>combineTool.py<span class="w"> </span>-M<span class="w"> </span>Impacts<span class="w"> </span>-d<span class="w"> </span>datacard_part3.root<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span><span class="w"> </span>--freezeParameters<span class="w"> </span>MH<span class="w"> </span>-n<span class="w"> </span>.impacts<span class="w"> </span>--setParameterRanges<span class="w"> </span><span class="nv">r</span><span class="o">=</span><span class="m">0</span>.5,2.5<span class="w"> </span>--doFits<span class="w"> </span>--robustFit<span class="w"> </span><span class="m">1</span>
</code></pre></div></p>
<p>3) Collect the outputs from the previous step and write the results to a json file:
<div class="highlight"><pre><span></span><code>combineTool.py<span class="w"> </span>-M<span class="w"> </span>Impacts<span class="w"> </span>-d<span class="w"> </span>datacard_part3.root<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span><span class="w"> </span>--freezeParameters<span class="w"> </span>MH<span class="w"> </span>-n<span class="w"> </span>.impacts<span class="w"> </span>--setParameterRanges<span class="w"> </span><span class="nv">r</span><span class="o">=</span><span class="m">0</span>.5,2.5<span class="w"> </span>-o<span class="w"> </span>impacts_part3.json
</code></pre></div></p>
<p>4) Produce a plot summarising the nuisance parameter values and impacts:
<div class="highlight"><pre><span></span><code>plotImpacts.py<span class="w"> </span>-i<span class="w"> </span>impacts_part3.json<span class="w"> </span>-o<span class="w"> </span>impacts_part3
</code></pre></div></p>
<p><img alt="" src="../plots/part3_impacts.png" /></p>
<p><strong>Tasks and questions:</strong></p>
<ul>
<li>Run the commands 1-4 above. There is a lot of information in these plots, which can be of invaluable use to analysers in understanding the fit. Do you understand everything that the plot is showing?</li>
<li>Which NP has the highest impact on the signal strength measurement?</li>
<li>Which NP is pulled the most in the fit to data? What does this information imply about the signal model mean in relation to the data?</li>
<li>Which NP is the most constrained in the fit to the data? What does it mean for a nuisance parameter to be constrained?</li>
<li>Try adding the option <code>--summary</code> to the impacts plotting command. This is a nice new feature in combine!</li>
</ul>
<h2 id="part-4-toy-generation-and-bias-studies">Part 4: Toy generation and bias studies</h2>
<p>With combine we can generate toy datasets from the compiled datacard workspace. Please read <a href="https://cms-analysis.github.io/HiggsAnalysis-CombinedLimit/part3/runningthetool/#toy-data-generation">this section</a> in the combine manual before proceeding.</p>
<p>An interesting use case of toy generation is when performing bias studies. In the Higgs to two photon (Hgg) analysis, the background is fit with some functional form. However (due to the complexities of QCD) the exact form of this function is unknown. Therefore, we need to understand how our choice of background function may impact the fitted signal strength. This is performed using a bias study, which will indicate how much potential bias is present given a certain choice of functional form.</p>
<p>In the classical bias studies we begin by building a set of workspaces which correspond to different background function choices. In addition to the <code>RooExponential</code> constructed in Section 1, let's also try a (4th order) <code>RooChebychev</code> polynomial and a simple power law function to fit the background <span class="arithmatex">\(m_{\gamma\gamma}\)</span> distribution.</p>
<p>The script used to fit the different functions and build the workspaces is <code>construct_models_bias_study_part4.py</code>. Take some time to look at the script and understand what the code is doing. In particular notice how we have saved the data as a <code>RooDataHist</code> in the workspace. This means we are now performing <strong>binned</strong> maximum likelihood fits (this is useful for part 4 to speed up fitting the many toys). If the binning is sufficiently granular, then there will be no noticeable difference in the results to the <strong>unbinned</strong> likelihood fits. Run the script with:
<div class="highlight"><pre><span></span><code>python3<span class="w">  </span>construct_models_bias_study_part4.py
</code></pre></div></p>
<p>The outputs are a set of workspaces which correspond to different choices of background model functions, and a plot showing fits of the different functions to the data mass sidebands.</p>
<p><img alt="" src="../plots/part4_data_sidebands.png" /></p>
<p>The datacards for the different background model functions are saved as <code>datacard_part4_{pdf}.txt</code> where <code>pdf = {exp,poly,pow}</code>. Have a look inside the .txt files and understand what changes have been made to pick up the different functions. Compile the datacards with:
<div class="highlight"><pre><span></span><code><span class="k">for</span><span class="w"> </span>pdf<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span>exp,poly,pow<span class="o">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>text2workspace.py<span class="w"> </span>datacard_part4_<span class="si">${</span><span class="nv">pdf</span><span class="si">}</span>.txt<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span><span class="p">;</span><span class="w"> </span><span class="k">done</span>
</code></pre></div></p>
<h3 id="bias-studies">Bias studies</h3>
<p>For the bias studies we want to generate ("throw") toy datasets with some choice of background function and fit back with another. The toys are thrown with a known value of the signal strength (r=1 in this example), which we will call <span class="arithmatex">\(r_{truth}\)</span>. The fitted value of r is defined as <span class="arithmatex">\(r_{fit}\)</span>, with some uncertainty <span class="arithmatex">\(\sigma_{fit}\)</span>. A pull value, <span class="arithmatex">\(P\)</span>, is calculated for each toy dataset according to,</p>
<div class="arithmatex">\[ P = (r_{truth}-r_{fit})/\sigma_{fit}\]</div>
<p>By repeating the process for many toys we can build up a pull distribution. If there is no bias present then we would expect to obtain a normal distribution centred at 0, with a standard deviation of 1. Let's calculate the bias for our analysis.</p>
<p>Firstly,  we generate N=1000 toys from each of the background function choices and save them in a ROOT file. For this we use the <code>GenerateOnly</code> method of combine. We will inject signal in the toys by setting <code>r=1</code> using the <code>--expectSignal 1</code> option.</p>
<p><strong>Tasks and questions:</strong></p>
<ul>
<li>Repeat the bias studies as outlined above with <code>--expectSignal 0</code>. This will inform us of the potential bias in the signal strength measurement given that there is no true signal.</li>
</ul>
<p>The following commands show the example of throwing 1000 toys from the exponential function, and then fitting back with the 4th-order Chebychev polynomial. We use the <code>singles</code> algorithm to obtain a value for <span class="arithmatex">\(r_{fit}\)</span> and <span class="arithmatex">\(\sigma_{fit}\)</span> simultaneously.
<div class="highlight"><pre><span></span><code>combine<span class="w"> </span>-M<span class="w"> </span>GenerateOnly<span class="w"> </span>datacard_part4_exp.root<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span><span class="w"> </span>--freezeParameters<span class="w"> </span>MH<span class="w"> </span>-t<span class="w"> </span><span class="m">1000</span><span class="w"> </span>-n<span class="w"> </span>.generate_exp<span class="w"> </span>--expectSignal<span class="w"> </span><span class="m">1</span><span class="w"> </span>--saveToys

combine<span class="w"> </span>-M<span class="w"> </span>MultiDimFit<span class="w"> </span>datacard_part4_poly.root<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span><span class="w"> </span>--freezeParameters<span class="w"> </span>MH<span class="w"> </span>-t<span class="w"> </span><span class="m">1000</span><span class="w"> </span>-n<span class="w"> </span>.bias_truth_exp_fit_poly<span class="w"> </span>--expectSignal<span class="w"> </span><span class="m">1</span><span class="w"> </span>--toysFile<span class="w"> </span>higgsCombine.generate_exp.GenerateOnly.mH125.123456.root<span class="w"> </span>--algo<span class="w"> </span>singles
</code></pre></div>
The script <code>plot_bias_pull.py</code> will plot the pull distribution and fit a Gaussian to it:
<div class="highlight"><pre><span></span><code>python3<span class="w"> </span>plot_bias_pull.py
</code></pre></div></p>
<p><img alt="" src="../plots/part4_pull_truth_exp_fit_poly.png" /></p>
<p>The potential bias is defined as the (fitted) mean of the pull distribution.</p>
<p><strong>Tasks and questions:</strong></p>
<ul>
<li>What is our bias value? Have we generated enough toys to be confident of the bias value? You could try generating more toys if not.</li>
<li>What threshold do we use to define "acceptable" bias?</li>
</ul>
<p>From the pull definition, we see the bias value is defined relative to the total uncertainty in the signal strength (denominator of <span class="arithmatex">\(\sigma_{fit}\)</span>). Some analyses use 0.14 as the threshold because a bias below this value would change the total uncertainty (when added in quadrature) by less than 1% (see equation below). Other analyses use 0.2 as this will change the total uncertainty by less than 2%. We should define the threshold before performing the bias study.</p>
<div class="arithmatex">\[ \sqrt{ 1^2 + 0.14^2} = 1.0098 \]</div>
<ul>
<li>How does our bias value compare to the thresholds? If we the bias is outside the acceptable region we should account for this using a <strong>spurious signal</strong> method (see advanced exercises TBA).</li>
<li>Repeat the bias study for each possible truth and fitted background function combinations. Do the bias values induced by the choice of background function merit adding a spurious signal component into the fit?</li>
<li>What would you expect the bias value to be for a background function that does not fit the data well? Should we be worried about such functions? What test could we use to reject such functions from the study beforehand?</li>
</ul>
<h2 id="part-5-discrete-profiling">Part 5: Discrete-profiling</h2>
<p>If multiple pdfs exist to fit some distribution, we can store all pdfs in a single workspace by using a <code>RooMultiPdf</code> object. The script <code>construct_models_multipdf_part5.py</code> shows how to store the exponential, (4th order) Chebychev polynomial and the power law function from the previous section in a <code>RooMultiPdf</code> object. This requires a <code>RooCategory</code> index, which controls the pdf which is active at any one time. Look at the contents of the script and then run with:
<div class="highlight"><pre><span></span><code>python3<span class="w"> </span>construct_models_multipdf_part5.py
</code></pre></div>
The file <code>datacard_part5.txt</code> will load the multipdf as the background model. Notice the line at the end of the datacard (see below). This tells combine about the <code>RooCategory</code> index.
<div class="highlight"><pre><span></span><code>pdfindex_Tag0<span class="w">         </span>discrete
</code></pre></div>
Compile the datacard with:
<div class="highlight"><pre><span></span><code>text2workspace.py<span class="w"> </span>datacard_part5.txt<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span>
</code></pre></div></p>
<p>The <code>RooMultiPdf</code> is a handy object for performing bias studies as all functions can be stored in a single workspace. You can then set which function is used for generating the toys with the <code>--setParameters pdfindex_Tag0=i</code> option, and which function is used for fitting with <code>--setParameters pdfindex_Tag0=j --freezeParameters pdfindex_Tag0</code> options.</p>
<p><strong>Tasks and questions:</strong></p>
<ul>
<li>It would be a useful exercise to repeat the bias studies from part 4 but using the RooMultiPdf workspace. What happens when you do not freeze the index in the fitting step?</li>
</ul>
<p>But simpler bias studies are not the only benefit of using the <code>RooMultiPdf</code>! It also allows us to apply the <a href="https://arxiv.org/pdf/1408.6865.pdf">discrete profiling method</a> in our analysis. In this method, the index labelling which pdf is active (a discrete nuisance parameter) is left floating in the fit, and will be profiled by looping through all the possible index values and finding the pdf which gives the best fit. In this manner, we are able to account for the <strong>uncertainty in the choice of the background function</strong>.</p>
<p>Note, by default, the multipdf will tell combine to add 0.5 to the NLL for each parameter in the pdf. This is known as the penalty term (or correction factor) for the discrete profiling method. You can toggle this term when building the workspace with the command <code>multipdf.setCorrectionFactor(0.5)</code>. You may need to change the value of this term to obtain an acceptable bias in your fit!</p>
<p>Let's run a likelihood scan using the compiled datacard with the <code>RooMultiPdf</code>:
<div class="highlight"><pre><span></span><code>combine<span class="w"> </span>-M<span class="w"> </span>MultiDimFit<span class="w"> </span>datacard_part5.root<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span><span class="w"> </span>--freezeParameters<span class="w"> </span>MH<span class="w"> </span>-n<span class="w"> </span>.scan.multidimfit<span class="w"> </span>--algo<span class="w"> </span>grid<span class="w"> </span>--points<span class="w"> </span><span class="m">20</span><span class="w"> </span>--cminDefaultMinimizerStrategy<span class="w"> </span><span class="m">0</span><span class="w"> </span>--saveSpecifiedIndex<span class="w"> </span>pdfindex_Tag0<span class="w"> </span>--setParameterRanges<span class="w"> </span><span class="nv">r</span><span class="o">=</span><span class="m">0</span>.5,2.5
</code></pre></div>
The option <code>--cminDefaultMinimizerStrategy 0</code> is required to prevent HESSE being called as this cannot handle discrete nuisance parameters. HESSE is the full calculation of the second derivative matrix (Hessian) of the likelihood using finite difference methods.</p>
<p>The option <code>--saveSpecifiedIndex pdfindex_Tag0</code> saves the value of the index at each point in the likelihood scan. Let's have a look at how the index value changes as a function of the signal strength. You can make the following plot by running:
<div class="highlight"><pre><span></span><code>python3<span class="w"> </span>plot_pdfindex.py
</code></pre></div></p>
<p><img alt="" src="../plots/part5_r_vs_pdfindex.png" /></p>
<p>By floating the discrete nuisance parameter <code>pdfindex_Tag0</code>, at each point in the likelihood scan the pdfs will be iterated over and the one which gives the max likelihood (lowest 2NLL) including the correction factor will be used. The plot above shows that the <code>pdfindex_Tag0=0</code> (exponential) is chosen for the majority of r values, but this switches to <code>pdfindex_Tag0=1</code> (Chebychev polynomial) at the lower edge of the r range. We can see the impact on the likelihood scan by fixing the pdf to the exponential:
<div class="highlight"><pre><span></span><code>combine<span class="w"> </span>-M<span class="w"> </span>MultiDimFit<span class="w"> </span>datacard_part5.root<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span><span class="w"> </span>--freezeParameters<span class="w"> </span>MH,pdfindex_Tag0<span class="w"> </span>--setParameters<span class="w"> </span><span class="nv">pdfindex_Tag0</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>-n<span class="w"> </span>.scan.multidimfit.fix_exp<span class="w"> </span>--algo<span class="w"> </span>grid<span class="w"> </span>--points<span class="w"> </span><span class="m">20</span><span class="w"> </span>--cminDefaultMinimizerStrategy<span class="w"> </span><span class="m">0</span><span class="w"> </span>--saveSpecifiedIndex<span class="w"> </span>pdfindex_Tag0<span class="w"> </span>--setParameterRanges<span class="w"> </span><span class="nv">r</span><span class="o">=</span><span class="m">0</span>.5,2.5
</code></pre></div>
Plotting the two scans on the same axis:
<div class="highlight"><pre><span></span><code>plot1DScan.py<span class="w"> </span>higgsCombine.scan.multidimfit.MultiDimFit.mH125.root<span class="w"> </span>--main-label<span class="w"> </span><span class="s2">&quot;Pdf choice floating&quot;</span><span class="w"> </span>--main-color<span class="w"> </span><span class="m">1</span><span class="w"> </span>--others<span class="w"> </span>higgsCombine.scan.multidimfit.fix_exp.MultiDimFit.mH125.root:<span class="s2">&quot;Pdf fixed to exponential&quot;</span>:2<span class="w"> </span>-o<span class="w"> </span>part5_scan<span class="w"> </span>--y-cut<span class="w"> </span><span class="m">35</span><span class="w"> </span>--y-max<span class="w"> </span><span class="m">35</span>
</code></pre></div></p>
<p><img alt="" src="../plots/part5_scan.png" /></p>
<p>The impact on the likelihood scan is evident at the lower edge, where the scan in which the index is floating flattens out. In this example, neither the <span class="arithmatex">\(1\sigma\)</span> or <span class="arithmatex">\(2\sigma\)</span> intervals are affected. But this is not always the case! Ultimately, this method allows us to account for the uncertainty in the choice of background function in the signal strength measurement.</p>
<p>Coming back to the bias studies. Do you now understand what you are testing if you do not freeze the index in the fitting stage? In this case you are fitting the toys back with the discrete profiling method. This is the standard approach for the bias studies when we use the discrete-profiling method in an analysis.</p>
<p>There are a number of options which can be added to the combine command to improve the performance when using discrete nuisance parameters. These are detailed at the end of this <a href="https://cms-analysis.github.io/HiggsAnalysis-CombinedLimit/part3/nonstandard/#discrete-profiling">section</a> in the combine manual.</p>
<h2 id="part-6-multi-signal-model">Part 6: Multi-signal model</h2>
<p>In reality, there are multiple Higgs boson processes which contribute to the total signal model, not only ggH. This section will explain how we can add an additional signal process (VBF) into the fit. Following this, we will add a second analysis category (Tag1), which has a higher purity of VBF events. To put this in context, the selection for Tag1 may require two jets with a large pseudorapidity separation and high invariant mass, which are typical properties of the VBF topology. By including this additional category with a different relative yield of VBF to ggH production, we are able to simultaneously constrain the rate of the two production modes.</p>
<p>In the SM, the VBF process has a cross section which is roughly 10 times smaller than the ggH cross section. This explains why we need to use certain features of the event to boost the purity of VBF events. The LO Feynman diagram for VBF production is shown below.</p>
<p><img alt="" src="../plots/part6_feynman.png" /></p>
<h3 id="building-the-models">Building the models</h3>
<p>Firstly, lets build the necessary inputs for this section using <code>construct_models_part6.py</code>. This script uses everything we have learnt in the previous sections:
1) Signal models (Gaussians) are built separately for each process (ggH and VBF) in each analysis category (Tag0 and Tag1). This uses separate <code>TTrees</code> for each contribution in the <code>mc_part6.root</code> file. The mean and width of the Gaussians include the effect of the parametric shape uncertainties, <code>nuisance_scale</code> and <code>nuisance_smear</code>. Each signal model is normalised according to the following equation, where <span class="arithmatex">\(\epsilon_{ij}\)</span> labels the fraction of process, <span class="arithmatex">\(i\)</span> (=ggH,VBF), landing in analysis category, <span class="arithmatex">\(j\)</span> (=Tag0,Tag1), and <span class="arithmatex">\(\mathcal{L}\)</span> is the integrated luminosity (defined in the datacard).</p>
<div class="arithmatex">\[ N_{ij} = \sigma_i \cdot \mathcal{B}^{\gamma\gamma} \cdot \epsilon_{ij} \cdot \mathcal{L}\]</div>
<p>2) A background model is constructed for each analysis category by fitting the mass sidebands in data. The input data is stored in the <code>data_part6.root</code> file. The models are <code>RooMultiPdfs</code> which contain an exponential, a 4th-order Chebychev polynomial and a power law function. The shape parameters and normalisation terms of the background models are freely floating in the final fit.</p>
<p><strong>Tasks and questions:</strong></p>
<ul>
<li>Have a look through the <code>construct_models_part6.py</code> script and try to understand all parts of the model construction. When you are happy, go ahead and construct the models with:
<div class="highlight"><pre><span></span><code>python3<span class="w"> </span>construct_models_part6.py
</code></pre></div></li>
</ul>
<p>The datacards for the two analysis categories are saved separately as <code>datacard_part6_Tag0.txt</code> and <code>datacard_part6_Tag1.txt</code>.</p>
<ul>
<li>Do you understand the changes made to include multiple signal processes in the datacard? What value in the <code>process</code> line is used to label VBF as a signal?</li>
<li>Try compiling the individual datacards. What are the prefit ggH and VBF yields in each analysis category? You can find these by opening the workspace and printing the contents.</li>
<li>Run the best fits and plot the prefit and postfit S+B models along with the data (see code in part 2). How does the absolute number of data events in Tag1 compare to Tag0? What about the signal-to-background ratio, S/B?</li>
</ul>
<p>In order to combine the two categories into a single datacard, we make use of the <code>combineCards.py</code> script:
<div class="highlight"><pre><span></span><code>combineCards.py<span class="w"> </span>datacard_part6_Tag0.txt<span class="w"> </span>datacard_part6_Tag1.txt<span class="w"> </span>&gt;<span class="w"> </span>datacard_part6_combined.txt
</code></pre></div></p>
<h3 id="running-the-fits">Running the fits</h3>
<p>If we use the default <code>text2workspace</code> command on the combined datacard, then this will introduce a single signal strength modifer which modifies the rate of all signal processes (ggH and VBF) by the same factor.</p>
<p><strong>Tasks and questions:</strong></p>
<ul>
<li>Try compiling the combined datacard and running a likelihood scan. Does the sensitivity to the global signal strength improve by adding the additional analysis category "Tag1"?</li>
</ul>
<p>If we want to measure the independent rates of both processes simultaneously, then we need to introduce a separate signal strength for ggH and VBF. To do this we use the <code>multiSignalModel</code> physics model in combine by adding the following options to the <code>text2workspace</code> command:
<div class="highlight"><pre><span></span><code>text2workspace.py<span class="w"> </span>datacard_part6_combined.txt<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span><span class="w"> </span>-P<span class="w"> </span>HiggsAnalysis.CombinedLimit.PhysicsModel:multiSignalModel<span class="w"> </span>--PO<span class="w"> </span><span class="s2">&quot;map=.*/ggH:r_ggH[1,0,2]&quot;</span><span class="w"> </span>--PO<span class="w"> </span><span class="s2">&quot;map=.*/VBF:r_VBF[1,0,3]&quot;</span><span class="w"> </span>-o<span class="w"> </span>datacard_part6_combined_multiSignalModel.root
</code></pre></div>
The syntax for the parameter to process mapping is <code>map=category/process/POI[default,min,max]</code>. We have used the wildcard <code>.*</code> to tell combine that the POI (parameter of interest) should scale all cases of that process, regardless of the analysis category. The output of this command tells us what is scaled by the two signal strengths:
<div class="highlight"><pre><span></span><code>Will<span class="w"> </span>scale<span class="w">  </span>ch1/ggH<span class="w">  </span>by<span class="w">  </span>r_ggH
Will<span class="w"> </span>scale<span class="w">  </span>ch1/VBF<span class="w">  </span>by<span class="w">  </span>r_VBF
Will<span class="w"> </span>scale<span class="w">  </span>ch1/bkg_mass<span class="w">  </span>by<span class="w">  </span><span class="m">1</span>
Will<span class="w"> </span>scale<span class="w">  </span>ch2/ggH<span class="w">  </span>by<span class="w">  </span>r_ggH
Will<span class="w"> </span>scale<span class="w">  </span>ch2/VBF<span class="w">  </span>by<span class="w">  </span>r_VBF
Will<span class="w"> </span>scale<span class="w">  </span>ch2/bkg_mass<span class="w">  </span>by<span class="w">  </span><span class="m">1</span>
Will<span class="w"> </span>scale<span class="w">  </span>ch1/ggH<span class="w">  </span>by<span class="w">  </span>r_ggH
Will<span class="w"> </span>scale<span class="w">  </span>ch1/VBF<span class="w">  </span>by<span class="w">  </span>r_VBF
Will<span class="w"> </span>scale<span class="w">  </span>ch1/bkg_mass<span class="w">  </span>by<span class="w">  </span><span class="m">1</span>
Will<span class="w"> </span>scale<span class="w">  </span>ch2/ggH<span class="w">  </span>by<span class="w">  </span>r_ggH
Will<span class="w"> </span>scale<span class="w">  </span>ch2/VBF<span class="w">  </span>by<span class="w">  </span>r_VBF
Will<span class="w"> </span>scale<span class="w">  </span>ch2/bkg_mass<span class="w">  </span>by<span class="w">  </span><span class="m">1</span>
</code></pre></div>
Exactly what we require!</p>
<p>To run a 1D "profiled" likelihood scan for ggH we use the following command:
<div class="highlight"><pre><span></span><code>combine<span class="w"> </span>-M<span class="w"> </span>MultiDimFit<span class="w"> </span>datacard_part6_combined_multiSignalModel.root<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span><span class="w"> </span>--freezeParameters<span class="w"> </span>MH<span class="w"> </span>-n<span class="w"> </span>.scan.part6_multiSignalModel_ggH<span class="w"> </span>--algo<span class="w"> </span>grid<span class="w"> </span>--points<span class="w"> </span><span class="m">20</span><span class="w"> </span>--cminDefaultMinimizerStrategy<span class="w"> </span><span class="m">0</span><span class="w"> </span>--saveInactivePOI<span class="w"> </span><span class="m">1</span><span class="w"> </span>-P<span class="w"> </span>r_ggH<span class="w"> </span>--floatOtherPOIs<span class="w"> </span><span class="m">1</span>
</code></pre></div></p>
<p><strong>Tasks and questions:</strong></p>
<ul>
<li>"Profiled" here means we are profiling over the other parameter of interest, <code>r_VBF</code> in the fit. In other words, we are treating <code>r_VBF</code> as an additional nuisance parameter. The option <code>--saveInactivePOI 1</code> stores the value of <code>r_VBF</code> in the combine output. Take a look at the fit output. Does the value of <code>r_VBF</code> depend on <code>r_ggH</code>? Are the two parameters of interest correlated? Remember, to look at the contents of the TTree you can use <code>limit-&gt;Show(i)</code>, where i is an integer labelling the point in the likelihood scan.</li>
<li>Run the profiled scan for the VBF signal strength. Plot the <code>r_ggH</code> and <code>r_VBF</code> likelihood scans using the <code>plot1DScan.py</code> script. You will need to change some of the input options, in particular the <code>--POI</code> option. You can list the full set of options by running:
<div class="highlight"><pre><span></span><code>plot1DScan.py<span class="w"> </span>--help
</code></pre></div></li>
</ul>
<h3 id="two-dimensional-likelihood-scan">Two-dimensional likelihood scan</h3>
<p>We can also run the fit at fixed points in (<code>r_ggH</code>,<code>r_VBF</code>) space. By using a sufficient number of points, we are able to up the 2D likelihood surface. Let's change the ranges of the parameters of interest to match what we have found in the profiled scans:
<div class="highlight"><pre><span></span><code>combine<span class="w"> </span>-M<span class="w"> </span>MultiDimFit<span class="w"> </span>datacard_part6_combined_multiSignalModel.root<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span><span class="w"> </span>--freezeParameters<span class="w"> </span>MH<span class="w"> </span>-n<span class="w"> </span>.scan2D.part6_multiSignalModel<span class="w"> </span>--algo<span class="w"> </span>grid<span class="w"> </span>--points<span class="w"> </span><span class="m">800</span><span class="w"> </span>--cminDefaultMinimizerStrategy<span class="w"> </span><span class="m">0</span><span class="w"> </span>-P<span class="w"> </span>r_ggH<span class="w"> </span>-P<span class="w"> </span>r_VBF<span class="w"> </span>--setParameterRanges<span class="w"> </span><span class="nv">r_ggH</span><span class="o">=</span><span class="m">0</span>.5,2.5:r_VBF<span class="o">=</span>-1,2
</code></pre></div>
To plot the output you can use the <code>plot_2D_scan.py</code> script:
<div class="highlight"><pre><span></span><code>python3<span class="w"> </span>plot_2D_scan.py
</code></pre></div>
This script interpolates the 2NLL value between the points ran in the scan so that the plot shows a smooth likelihood surface. You may find in some cases, the number of scanned points and interpolation parameters need to be tuned to get a sensible looking surface. This basically depends on how complicated the likelihood surface is.</p>
<p><img alt="" src="../plots/part6_scan2D_r_ggH_vs_r_VBF.png" /></p>
<p><strong>Tasks and questions:</strong></p>
<ul>
<li>The plot shows that the data is in agreement with the SM within the <span class="arithmatex">\(2\sigma\)</span> CL. Here, the <span class="arithmatex">\(1\sigma\)</span> and <span class="arithmatex">\(2\sigma\)</span> confidence interval contours corresponds to 2NLL values of 2.3 and 5.99, respectively. Do you understand why this? Think about Wilk's theorem.</li>
<li>Does the plot show any correlation between the ggH and VBF signal strengths? Are the two positively or negatively correlated? Does this make sense for this pair of parameters given the analysis setup? Try repeating the 2D likelihood scan using the "Tag0" only datacard. How does the correlation behaviour change?</li>
<li>How can we read off the "profiled" 1D likelihood scan constraints from this plot?</li>
</ul>
<h3 id="correlations-between-parameters">Correlations between parameters</h3>
<p>For template-based analyses we can use the <code>FitDiagnostics</code> method in combine to extract the covariance matrix for the fit parameters. Unfortunately, this method is not compatible when using discrete nuisance parameters (<code>RooMultiPdf</code>). Instead, we can use the <code>robustHesse</code> method to find the Hessian matrix by finite difference methods. The matrix is then inverted to get the covariance. Subsequently, we can use the covariance to extract the correlations between fit parameters.
<div class="highlight"><pre><span></span><code>combine<span class="w"> </span>-M<span class="w"> </span>MultiDimFit<span class="w"> </span>datacard_part6_combined_multiSignalModel.root<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span><span class="w"> </span>--freezeParameters<span class="w"> </span>MH<span class="w"> </span>-n<span class="w"> </span>.robustHesse.part6_multiSignalModel<span class="w"> </span>--cminDefaultMinimizerStrategy<span class="w"> </span><span class="m">0</span><span class="w"> </span>-P<span class="w"> </span>r_ggH<span class="w"> </span>-P<span class="w"> </span>r_VBF<span class="w"> </span>--setParameterRanges<span class="w"> </span><span class="nv">r_ggH</span><span class="o">=</span><span class="m">0</span>.5,2.5:r_VBF<span class="o">=</span>-1,2<span class="w"> </span>--robustHesse<span class="w"> </span><span class="m">1</span><span class="w"> </span>--robustHesseSave<span class="w"> </span><span class="m">1</span><span class="w"> </span>--saveFitResult
</code></pre></div>
The output file <code>robustHesse.robustHesse.part6_multiSignalModel.root</code> stores the correlation matrix (<code>h_correlation</code>). This contains the correlations between all parameters including the nuisances. So if we are interested in the correlation between <code>r_ggH</code> and <code>r_VBF</code>, we first need to find which bin corresponds to these parameters:
<div class="highlight"><pre><span></span><code>root<span class="w"> </span>robustHesse.robustHesse.part6_multiSignalModel.root

root<span class="w"> </span><span class="o">[</span><span class="m">1</span><span class="o">]</span><span class="w"> </span>h_correlation-&gt;GetXaxis<span class="o">()</span>-&gt;GetBinLabel<span class="o">(</span><span class="m">19</span><span class="o">)</span>
<span class="o">(</span>const<span class="w"> </span>char<span class="w"> </span>*<span class="o">)</span><span class="w"> </span><span class="s2">&quot;r_VBF&quot;</span>
root<span class="w"> </span><span class="o">[</span><span class="m">2</span><span class="o">]</span><span class="w"> </span>h_correlation-&gt;GetYaxis<span class="o">()</span>-&gt;GetBinLabel<span class="o">(</span><span class="m">20</span><span class="o">)</span>
<span class="o">(</span>const<span class="w"> </span>char<span class="w"> </span>*<span class="o">)</span><span class="w"> </span><span class="s2">&quot;r_ggH&quot;</span>
root<span class="w"> </span><span class="o">[</span><span class="m">3</span><span class="o">]</span><span class="w"> </span>h_correlation-&gt;GetBinContent<span class="o">(</span><span class="m">19</span>,20<span class="o">)</span>
<span class="o">(</span>double<span class="o">)</span><span class="w"> </span>-0.19822058
</code></pre></div></p>
<p><strong>Tasks and questions:</strong></p>
<ul>
<li>The two parameters of interest have a correlation coefficient of -0.198. This means the two parameters are somewhat anti-correlated. Does this match what we see in the 2D likelihood scan?</li>
</ul>
<h3 id="impacts_1">Impacts</h3>
<p>We extract the impacts for each parameter of interest using the following commands:
<div class="highlight"><pre><span></span><code>combineTool.py<span class="w"> </span>-M<span class="w"> </span>Impacts<span class="w"> </span>-d<span class="w"> </span>datacard_part6_combined_multiSignalModel.root<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span><span class="w"> </span>--freezeParameters<span class="w"> </span>MH<span class="w"> </span>-n<span class="w"> </span>.impacts_part6_multiSignal<span class="w"> </span>--robustFit<span class="w"> </span><span class="m">1</span><span class="w"> </span>--cminDefaultMinimizerStrategy<span class="w"> </span><span class="m">0</span><span class="w"> </span>-P<span class="w"> </span>r_ggH<span class="w"> </span>-P<span class="w"> </span>r_VBF<span class="w"> </span>--doInitialFit

combineTool.py<span class="w"> </span>-M<span class="w"> </span>Impacts<span class="w"> </span>-d<span class="w"> </span>datacard_part6_combined_multiSignalModel.root<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span><span class="w"> </span>--freezeParameters<span class="w"> </span>MH<span class="w"> </span>-n<span class="w"> </span>.impacts_part6_multiSignal<span class="w"> </span>--robustFit<span class="w"> </span><span class="m">1</span><span class="w"> </span>--cminDefaultMinimizerStrategy<span class="w"> </span><span class="m">0</span><span class="w"> </span>-P<span class="w"> </span>r_ggH<span class="w"> </span>-P<span class="w"> </span>r_VBF<span class="w"> </span>--doFits

combineTool.py<span class="w"> </span>-M<span class="w"> </span>Impacts<span class="w"> </span>-d<span class="w"> </span>datacard_part6_combined_multiSignalModel.root<span class="w"> </span>-m<span class="w"> </span><span class="m">125</span><span class="w"> </span>--freezeParameters<span class="w"> </span>MH<span class="w"> </span>-n<span class="w"> </span>.impacts_part6_multiSignal<span class="w"> </span>--robustFit<span class="w"> </span><span class="m">1</span><span class="w"> </span>--cminDefaultMinimizerStrategy<span class="w"> </span><span class="m">0</span><span class="w"> </span>-P<span class="w"> </span>r_ggH<span class="w"> </span>-P<span class="w"> </span>r_VBF<span class="w"> </span>-o<span class="w"> </span>impacts_part6.json

plotImpacts.py<span class="w"> </span>-i<span class="w"> </span>impacts_part6.json<span class="w"> </span>-o<span class="w"> </span>impacts_part6_r_ggH<span class="w"> </span>--POI<span class="w"> </span>r_ggH
plotImpacts.py<span class="w"> </span>-i<span class="w"> </span>impacts_part6.json<span class="w"> </span>-o<span class="w"> </span>impacts_part6_r_VBF<span class="w"> </span>--POI<span class="w"> </span>r_VBF
</code></pre></div></p>
<p><strong>Tasks and questions:</strong></p>
<ul>
<li>Look at the output PDF files. How does the ranking of the nuisance parameters change for the different signal strengths?</li>
</ul>
<h2 id="advanced-exercises-to-be-added">Advanced exercises (to be added)</h2>
<p>The combine experts will include additional exercises here in due course. These will include:</p>
<ul>
<li>Convolution of model pdfs: <code>RooAddPdf</code></li>
<li>Application of the spurious signal method</li>
<li>Advanced physics models including parametrised signal strengths e.g. SMEFT</li>
<li>Mass fits</li>
<li>Two-dimensional parametric models</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../../part5/longexerciseanswers/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Solutions">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Solutions
              </div>
            </div>
          </a>
        
        
          
          <a href="../../tutorial2023_unfolding/unfolding_exercise/" class="md-footer__link md-footer__link--next" aria-label="Next: Likelihood Based Unfolding">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Likelihood Based Unfolding
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "navigation.footer", "navigation.indexes", "navigation.expand", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "search.highlight", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>