
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../nonstandard/">
      
      
        <link rel="next" href="../regularisation/">
      
      
      <link rel="icon" href="../../logo.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.13">
    
    
      
        <title>Simplified Likelihoods - Combine</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e359304.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../mystyle.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#procedure-for-creating-and-validating-simplified-likelihood-inputs" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
  You're not viewing the latest version.
  <a href="../../.."> 


    <strong>Click here to go to latest.</strong>
  </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Combine" class="md-header__button md-logo" aria-label="Combine" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Combine
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Simplified Likelihoods
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/cms-analysis/HiggsAnalysis-CombinedLimit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../what_combine_does/introduction/" class="md-tabs__link">
          
  
    
  
  What Combine Does

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../part2/settinguptheanalysis/" class="md-tabs__link">
          
  
    
  
  Setting up the analysis

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../runningthetool/" class="md-tabs__link">
          
  
    
  
  Running combine

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../part5/roofit/" class="md-tabs__link">
          
  
    
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../part4/usefullinks/" class="md-tabs__link">
        
  
    
  
  Links & FAQ

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Combine" class="md-nav__button md-logo" aria-label="Combine" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    Combine
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/cms-analysis/HiggsAnalysis-CombinedLimit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    What Combine Does
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            What Combine Does
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../what_combine_does/introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../what_combine_does/model_and_likelihood/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Model and Likelihood
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../what_combine_does/fitting_concepts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fitting Concepts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../what_combine_does/statistical_tests/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Statistical Tests
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Setting up the analysis
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Setting up the analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/settinguptheanalysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Preparing the datacard
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/physicsmodels/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Physics models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part2/bin-wise-stats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Automatic MC statistical uncertainties
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Running combine
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Running combine
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../runningthetool/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Running the tool
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../commonstatsmethods/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Common statistical methods
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nonstandard/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced use cases
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Simplified Likelihoods
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Simplified Likelihoods
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Requirements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#producing-covariance-for-recasting" class="md-nav__link">
    <span class="md-ellipsis">
      Producing covariance for recasting
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Producing covariance for recasting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#type-a-control-regions-included-in-datacard" class="md-nav__link">
    <span class="md-ellipsis">
      Type A - Control regions included in datacard
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type-b-control-regions-not-included-in-datacard" class="md-nav__link">
    <span class="md-ellipsis">
      Type B - Control regions not included in datacard
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#produce-simplified-likelihood-inputs" class="md-nav__link">
    <span class="md-ellipsis">
      Produce simplified likelihood inputs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Produce simplified likelihood inputs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#not-aggregating" class="md-nav__link">
    <span class="md-ellipsis">
      Not Aggregating
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregating" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregating
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validating-the-simplified-likelihood-approach" class="md-nav__link">
    <span class="md-ellipsis">
      Validating the simplified likelihood approach
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Validating the simplified likelihood approach">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#convert-root-to-python" class="md-nav__link">
    <span class="md-ellipsis">
      Convert ROOT to Python
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-a-likelihood-scan-with-the-sl" class="md-nav__link">
    <span class="md-ellipsis">
      Run a likelihood scan with the SL
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-using-tutorial-datacard" class="md-nav__link">
    <span class="md-ellipsis">
      Example using tutorial datacard
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../regularisation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unfolding & regularization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../validation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Validating datacards
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../debugging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debugging fit failures
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/roofit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RooFit Basics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Main Features
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Main Features
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/longexercise/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Exercises
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part5/longexerciseanswers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Solutions
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial2023/parametric_exercise/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parametric Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial2023_unfolding/unfolding_exercise/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Likelihood Based Unfolding
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../part4/usefullinks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Links & FAQ
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Requirements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#producing-covariance-for-recasting" class="md-nav__link">
    <span class="md-ellipsis">
      Producing covariance for recasting
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Producing covariance for recasting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#type-a-control-regions-included-in-datacard" class="md-nav__link">
    <span class="md-ellipsis">
      Type A - Control regions included in datacard
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type-b-control-regions-not-included-in-datacard" class="md-nav__link">
    <span class="md-ellipsis">
      Type B - Control regions not included in datacard
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#produce-simplified-likelihood-inputs" class="md-nav__link">
    <span class="md-ellipsis">
      Produce simplified likelihood inputs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Produce simplified likelihood inputs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#not-aggregating" class="md-nav__link">
    <span class="md-ellipsis">
      Not Aggregating
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregating" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregating
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validating-the-simplified-likelihood-approach" class="md-nav__link">
    <span class="md-ellipsis">
      Validating the simplified likelihood approach
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Validating the simplified likelihood approach">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#convert-root-to-python" class="md-nav__link">
    <span class="md-ellipsis">
      Convert ROOT to Python
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-a-likelihood-scan-with-the-sl" class="md-nav__link">
    <span class="md-ellipsis">
      Run a likelihood scan with the SL
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-using-tutorial-datacard" class="md-nav__link">
    <span class="md-ellipsis">
      Example using tutorial datacard
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="procedure-for-creating-and-validating-simplified-likelihood-inputs">Procedure for creating and validating simplified likelihood inputs</h1>
<p>This page is to give a brief outline for the creation of (potentially aggregated) predictions and their covariance to facilitate external reinterpretation using the simplified likelihood (SL) approach. Instructions for validating the simplified likelihood method (detailed in the CMS note <a href="https://cds.cern.ch/record/2242860/files/NOTE2017_001.pdf">here</a> and "<a href="https://link.springer.com/article/10.1007/JHEP04(2019)064">The Simplified Likelihood Framework</a>" paper) are also given.</p>
<h2 id="requirements">Requirements</h2>
<p>You need an up to date version of <span style="font-variant:small-caps;">Combine</span>. Note You should use the latest release of <span style="font-variant:small-caps;">Combine</span> for the exact commands on this page. You should be using <span style="font-variant:small-caps;">Combine</span> tag <code>v9.0.0</code> or higher or the latest version of the <code>112x</code> branch to follow these instructions.  </p>
<p>You will find the python scripts needed to convert <span style="font-variant:small-caps;">Combine</span> outputs into simplified likelihood inputs under <code>test/simplifiedLikelihood</code></p>
<p>If you're using the <code>102x</code> branch (not recommended), then you can obtain these scripts from here by running: </p>
<pre><code>curl -s https://raw.githubusercontent.com/nucleosynthesis/work-tools/master/sparse-checkout-SL-ssh.sh &gt; checkoutSL.sh
bash checkoutSL.sh
ls work-tools/stats-tools
</code></pre>
<p>If you also want to validate your inputs and perform fits/scans using them, you can use the package <a href="https://gitlab.cern.ch/SimplifiedLikelihood/SLtools/-/blob/master/README.md">SLtools</a> from <a href="https://link.springer.com/article/10.1007/JHEP04(2019)064">The Simplified Likelihood Framework</a> paper for this.</p>
<pre><code>git clone https://gitlab.cern.ch/SimplifiedLikelihood/SLtools.git
</code></pre>
<h2 id="producing-covariance-for-recasting">Producing covariance for recasting</h2>
<p>Producing the necessary predictions and covariance for recasting varies depending on whether or not control regions are explicitly included in the datacard when running fits. Instructions for cases where the control regions <em>are</em> and <em>are not</em> included are detailed below.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The instructions below will calculate moments based on the assumption that <span class="arithmatex"><span class="MathJax_Preview">E[x]=\hat{x}</span><script type="math/tex">E[x]=\hat{x}</script></span>, i.e it will use the maximum likelihood estimators for the yields as the expectation values. If instead you want to use the full definition of the moments, you can run the <code>FitDiagnostics</code> method with the <code>-t</code> option and include <code>--savePredictionsPerToy</code> and remove the other options, which will produce a tree of the toys in the output from which moments can be calculated. </p>
</div>
<h3 id="type-a-control-regions-included-in-datacard">Type A - Control regions included in datacard</h3>
<p>For an example datacard 'datacard.txt' including two signal channels 'Signal1' and 'Signal2', make the workspace including the masking flags</p>
<pre><code>text2workspace.py --channel-masks --X-allow-no-signal --X-allow-no-background datacard.txt -o datacard.root
</code></pre>
<p>Run the fit making the covariance (output saved as <code>fitDiagnostics.root</code>) masking the signal channels. Note that all signal channels must be masked!</p>
<pre><code>combine datacard.root -M FitDiagnostics --saveShapes --saveWithUnc --numToysForShape 2000 --setParameters mask_Signal1=1,mask_Signal2=1 --saveOverall  -N Name
</code></pre>
<p>Where "Name" can be specified by you.</p>
<p>Outputs, including predictions and covariance, will be saved in <code>fitDiagnosticsName.root</code> folder <code>shapes_fit_b</code></p>
<h3 id="type-b-control-regions-not-included-in-datacard">Type B - Control regions not included in datacard</h3>
<p>For an example datacard 'datacard.txt' including two signal channels 'Signal1' and 'Signal2', make the workspace</p>
<pre><code>text2workspace.py --X-allow-no-signal --X-allow-no-background datacard.txt -o datacard.root
</code></pre>
<p>Run the fit making the covariance (output saved as <code>fitDiagnosticsName.root</code>) setting no pre-fit signal contribution. Note we <em>must</em> set <code>--preFitValue 0</code> in this case since, we will be using the pre-fit uncertainties for the covariance calculation and we do not want to include the uncertainties on the signal. </p>
<pre><code>combine datacard.root -M FitDiagnostics --saveShapes --saveWithUnc --numToysForShape 2000 --saveOverall --preFitValue 0   -n Name
</code></pre>
<p>Where "Name" can be specified by you.</p>
<p>Outputs, including predictions and covariance, will be saved in <code>fitDiagnosticsName.root</code> folder <code>shapes_prefit</code></p>
<p>In order to also extract the signal yields corresponding to <code>r=1</code> (in case you want to run the validation step later), you also need to produce a second file with the pre-fit value set to 1. For this you do not need to run many toys. To save time you can set <code>--numToysForShape</code> to a low value. </p>
<pre><code>combine datacard.root -M FitDiagnostics --saveShapes --saveWithUnc --numToysForShape 1 --saveOverall --preFitValue 1   -n Name2
</code></pre>
<p>You should check that the order of the bins in the covariance matrix is as expected.</p>
<h2 id="produce-simplified-likelihood-inputs">Produce simplified likelihood inputs</h2>
<p>Head over to the <code>test/simplifiedLikelihoods</code> directory inside your <span style="font-variant:small-caps;">Combine</span> area. The following instructions depend on whether you are aggregating or not aggregating your signal regions. Choose the instructions for your case. </p>
<h3 id="not-aggregating">Not Aggregating</h3>
<p>Run the <code>makeLHInputs.py</code> script to prepare the inputs for the simplified likelihood. The filter flag can be used to select only signal regions based on the channel names. To include all channels do not include the filter flag.</p>
<p>The SL input must NOT include any control regions that were not masked in the fit.</p>
<p>If your analysis is Type B (i.e everything in the datacard is a signal region), then you can just run </p>
<pre><code>python makeLHInputs.py -i fitDiagnosticsName.root -o SLinput.root 
</code></pre>
<p>If necessary (i.e as in Type B analyses) you may also need to run the same on the output of the run where the pre-fit value was set to 1. </p>
<pre><code>python makeLHInputs.py -i fitDiagnosticsName2.root -o SLinput2.root 
</code></pre>
<p>If you instead have a Type A analysis (some of the regions are control regions that were used to fit but not masked) then you should add the option <code>--filter SignalName</code> where <code>SignalName</code> is some string that defines the signal regions in your datacards (for example, "SR" is a common name for these).</p>
<p>Note: If your signal regions cannot be easily identified by a string, follow the instructions below for aggregating, but define only one channel for each aggregate region. This will maintain the full information and will not actually aggregate any regions.</p>
<h3 id="aggregating">Aggregating</h3>
<p>If aggregating based on covariance, edit the config file <code>aggregateCFG.py</code> to define aggregate regions based on channel names. Note that wildcards are supported. You can then make likelihood inputs using</p>
<pre><code>python makeLHInputs.py -i fitDiagnosticsName.root -o SLinput.root --config aggregateCFG.py
</code></pre>
<p>At this point you have the inputs as ROOT files necessary to publish and run the simplified likelihood. </p>
<h2 id="validating-the-simplified-likelihood-approach">Validating the simplified likelihood approach</h2>
<p>The simplified likelihood relies on several assumptions (detailed in the documentation at the top). To test the validity for your analysis, statistical results between <span style="font-variant:small-caps;">Combine</span> and the simplified likelihood can be compared. </p>
<p>We will use the package <a href="https://gitlab.cern.ch/SimplifiedLikelihood/SLtools/-/blob/master/README.md">SLtools</a> from the <a href="https://link.springer.com/article/10.1007/JHEP04(2019)064">Simplified Likelihood Paper</a> for this. The first step is to convert the ROOT files into python configs to run in the tool. </p>
<h3 id="convert-root-to-python">Convert ROOT to Python</h3>
<p>If you followed the steps above, you have all of the histograms already necessary to generate the python configs. The script <code>test/simplifiedLikelihoods/convertSLRootToPython.py</code>  can be used to do the conversion. Just provide the following options when running with python.</p>
<ul>
<li><code>-O/--outname</code> : The output python file containing the model (default is <code>test.py</code>)</li>
<li><code>-s/--signal</code> : The signal histogram, should be of format <code>file.root:location/to/histogram</code></li>
<li><code>-b/--background</code> : The background histogram, should be of format <code>file.root:location/to/histogram</code></li>
<li><code>-d/--data</code> : The data TGraph, should be of format <code>file.root:location/to/graph</code></li>
<li><code>-c/--covariance</code> : The covariance TH2 histogram, should be of format <code>file.root:location/to/histogram</code></li>
</ul>
<p>For example, to get the correct output from a Type B analysis with no aggregating, you can run </p>
<pre><code class="language-sh">python test/simplifiedLikelihoods/convertSLRootToPython.py -O mymodel.py -s SLinput.root:shapes_prefit/total_signal  -b SLinput.root:shapes_prefit/total_M2 d -d SLinput.root:shapes_prefit/total_data -c SLinput.root:shapes_prefit/total_M2
</code></pre>
<p>The output will be a python file with the right format for the SL tool. You can mix different ROOT files for these inputs. Note that the <code>SLtools</code> package also has some tools to covert <code>.yaml</code>-based inputs into the python config for you.</p>
<h3 id="run-a-likelihood-scan-with-the-sl">Run a likelihood scan with the SL</h3>
<p>If you have checked out the <a href="https://gitlab.cern.ch/SimplifiedLikelihood/SLtools/-/blob/master/README.md">SLtools</a>, you can create a simple python script as the one below to produce a scan of the simplified likelihood from your inputs.</p>
<pre><code class="language-python">#! /usr/bin/env python
import simplike as sl

exec(open(&quot;mymodel.py&quot;).read())
slp1 = sl.SLParams(background, covariance, obs=data, sig=signal)

import numpy as np
npoints = 50
mus = np.arange(-0.5, 2, (2+0.5)/npoints)
tmus1 = [slp1.tmu(mu) for mu in mus]
from matplotlib import pyplot as plt
plt.plot(mus,tmus1)
plt.show()
</code></pre>
<p>Where the <code>mymodel.py</code> config is a simple python file defined as;</p>
<ul>
<li><code>data</code> : A python array of observed data, one entry per bin.</li>
<li><code>background</code> : A python array of expected background, one entry per bin.</li>
<li><code>covariance</code> : A python array of the covariance between expected backgrounds. The format is a flat array which is converted into a 2D array inside the tool</li>
<li><code>signal</code> : A python array of the expected signal, one entry per bin. This should be replaced with whichever signal model you are testing.</li>
</ul>
<p>This <code>model.py</code> can also just be the output of the previous section converted from the ROOT files for you.</p>
<p>The example below is from the note CMS-NOTE-2017-001</p>
<details>
<summary><b>Show example</b></summary>

<pre><code>
import numpy
import array

name = "CMS-NOTE-2017-001 dummy model"
nbins = 8
data = array.array('d',[1964,877,354,182,82,36,15,11])
background = array.array('d',[2006.4,836.4,350.,147.1,62.0,26.2,11.1,4.7])
signal = array.array('d',[47,29.4,21.1,14.3,9.4,7.1,4.7,4.3])
covariance = array.array('d', [ 18774.2, -2866.97, -5807.3, -4460.52, -2777.25, -1572.97, -846.653, -442.531, -2866.97, 496.273, 900.195, 667.591, 403.92, 222.614, 116.779, 59.5958, -5807.3, 900.195, 1799.56, 1376.77, 854.448, 482.435, 258.92, 134.975, -4460.52, 667.591, 1376.77, 1063.03, 664.527, 377.714, 203.967, 106.926, -2777.25, 403.92, 854.448, 664.527, 417.837, 238.76, 129.55, 68.2075, -1572.97, 222.614, 482.435, 377.714, 238.76, 137.151, 74.7665, 39.5247, -846.653, 116.779, 258.92, 203.967, 129.55, 74.7665, 40.9423, 21.7285, -442.531, 59.5958, 134.975, 106.926, 68.2075, 39.5247, 21.7285, 11.5732])
</pre></code>
</details>

<h2 id="example-using-tutorial-datacard">Example using tutorial datacard</h2>
<p>For this example, we will use the tutorial datacard <code>data/tutorials/longexercise/datacard_part3.txt</code>. This datacard is of <strong>Type B</strong> since there are no control regions (all regions are signal regions). </p>
<p>First, we will create the binary file (run <code>text2workspace</code>)</p>
<pre><code>text2workspace.py --X-allow-no-signal --X-allow-no-background data/tutorials/longexercise/datacard_part3.txt  -m 200
</code></pre>
<p>And next, we will generate the covariance between the bins of the background model. </p>
<pre><code>combine data/tutorials/longexercise/datacard_part3.root -M FitDiagnostics --saveShapes --saveWithUnc --numToysForShape 10000 --saveOverall --preFitValue 0   -n SimpleTH1 -m 200

combine data/tutorials/longexercise/datacard_part3.root -M FitDiagnostics --saveShapes --saveWithUnc --numToysForShape 1 --saveOverall --preFitValue 1   -n SimpleTH1_Signal1 -m 200
</code></pre>
<p>We will also want to compare our scan to that from the full likelihood, which we can get as usual from <span style="font-variant:small-caps;">Combine</span>. </p>
<pre><code>combine -M MultiDimFit data/tutorials/longexercise/datacard_part3.root --rMin -0.5 --rMax 2 --algo grid -n SimpleTH1 -m 200
</code></pre>
<p>Next, since we do not plan to aggregate any of the bins, we will follow the instructions for this and pick out the right covariance matrix.</p>
<pre><code>python test/simplifiedLikelihoods/makeLHInputs.py -i fitDiagnosticsSimpleTH1.root -o SLinput.root 

python test/simplifiedLikelihoods/makeLHInputs.py -i fitDiagnosticsSimpleTH1_Signal1.root -o SLinput_Signal1.root 
</code></pre>
<p>We now have everything we need to provide the simplified likelihood inputs:</p>
<pre><code>$ root -l SLinput.root
root [0] .ls

Attaching file SLinput.root as _file0...
(TFile *) 0x3667820
root [1] .ls
TFile**         SLinput.root
 TFile*         SLinput.root
  KEY: TDirectoryFile   shapes_fit_b;1  shapes_fit_b
  KEY: TDirectoryFile   shapes_prefit;1 shapes_prefit
  KEY: TDirectoryFile   shapes_fit_s;1  shapes_fit_s
</code></pre>
<p>We can convert this to a python module that we can use to run a scan with the <code>SLtools</code> package. Note, since we have a <strong>Type B</strong> datacard, we will be using the <em>pre-fit</em> covariance matrix. Also, this means we want to take the signal from the file where the prefit value of <code>r</code> was 1. </p>
<pre><code>python test/simplifiedLikelihoods/convertSLRootToPython.py -O mymodel.py -s SLinput_Signal1.root:shapes_prefit/total_signal  -b SLinput.root:shapes_prefit/total_M1-d SLinput.root:shapes_prefit/total_data -c SLinput.root:shapes_prefit/total_M2
</code></pre>
<p>We can compare the profiled likelihood scans from our simplified likelihood (using the python file we just created) and from the full likelihood (that we created with <span style="font-variant:small-caps;">Combine</span>.). For the former, we need to first checkout the <code>SLtools</code> package </p>
<pre><code>git clone https://gitlab.cern.ch/SimplifiedLikelihood/SLtools.git
mv higgsCombineSimpleTH1.MultiDimFit.mH200.root SLtools/ 
mv mymodel.py SLtools/
cd SLtools
</code></pre>
<p>The script below will create a plot of the comparison for us. </p>
<pre><code class="language-python">#! /usr/bin/env python
import simplike as sl

exec(open(&quot;mymodel.py&quot;).read())

slp1 = sl.SLParams(background, covariance, obs=data, sig=signal)

import ROOT 
fi = ROOT.TFile.Open(&quot;higgsCombineSimpleTH1.MultiDimFit.mH200.root&quot;)
tr = fi.Get(&quot;limit&quot;)

points = []
for i in range(tr.GetEntries()):
  tr.GetEntry(i)
  points.append([tr.r,2*tr.deltaNLL])
points.sort()

mus2=[pt[0] for pt in points]
tmus2=[pt[1] for pt in points]

import numpy as np
npoints = 50
mus1 = np.arange(-0.5, 2, (2+0.5)/npoints)
tmus1 = [slp1.tmu(mu) for mu in mus1]

from matplotlib import pyplot as plt
plt.plot(mus1,tmus1,label='simplified likelihood')
plt.plot(mus2,tmus2,label='full likelihood')
plt.legend()
plt.xlabel(&quot;$\mu$&quot;)
plt.ylabel(&quot;$-2\Delta \ln L$&quot;)

plt.savefig(&quot;compareLH.pdf&quot;)
</code></pre>
<p>This will produce a figure like the one below. </p>
<p><img alt="" src="../SLexample.jpg" /></p>
<p>It is also possible to include the third moment of each bin to improve the precision of the simplified likelihood [ <a href="https://link.springer.com/article/10.1007/JHEP04(2019)064">JHEP 64 2019</a> ]. The necessary information is stored in the outputs from <span style="font-variant:small-caps;">Combine</span>, therefore you just need to include the option <code>-t SLinput.root:shapes_prefit/total_M3</code> in the options list for <code>convertSLRootToPython.py</code> to  include this in the model file. The third moment information can be included in <code>SLtools</code> by using <code>sl.SLParams(background, covariance, third_moment, obs=data, sig=signal)</code></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../nonstandard/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Advanced use cases">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Advanced use cases
              </div>
            </div>
          </a>
        
        
          
          <a href="../regularisation/" class="md-footer__link md-footer__link--next" aria-label="Next: Unfolding &amp; regularization">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Unfolding & regularization
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "navigation.footer", "navigation.indexes", "navigation.expand", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "search.highlight", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8d2eff1.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>